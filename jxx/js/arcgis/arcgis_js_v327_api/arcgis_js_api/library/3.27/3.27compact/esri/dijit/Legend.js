// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/debounce":function(){define([],function(){return function(l,p){var f;return function(){f&&clearTimeout(f);var c=this,g=arguments;f=setTimeout(function(){l.apply(c,g)},p)}}})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(l,p,f){l.DeferredList=function(c,g,w,k,d){var t=[];p.call(this);var l=this;0!==c.length||g||this.resolve([0,[]]);var y=0;f.forEach(c,function(d,f){function p(b,d){t[f]=[b,d];y++;y===c.length&&l.resolve(t)}
d.then(function(b){g?l.resolve([f,b]):p(!0,b)},function(b){w?l.reject(b):p(!1,b);if(k)return null;throw b;})})};l.DeferredList.prototype=new p;l.DeferredList.prototype.gatherResults=function(c){c=new l.DeferredList(c,!1,!0,!1);c.addCallback(function(c){var g=[];f.forEach(c,function(c){g.push(c[1])});return g});return c};return l.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(l,p,f,c,g,w,k,d,t,H,y,I,z){function u(){}function b(b){return function(d,n,c,t){return d&&"string"==typeof n&&d[n]==u?d.on(n.substring(2).toLowerCase(),k.hitch(c,t)):b.apply(f,arguments)}}l.around(f,"connect",b);w.connect&&l.around(w,"connect",b);l=c("dijit._Widget",[y,I,z],{onClick:u,onDblClick:u,onKeyDown:u,onKeyPress:u,onKeyUp:u,onMouseDown:u,onMouseMove:u,onMouseOut:u,onMouseOver:u,onMouseLeave:u,onMouseEnter:u,onMouseUp:u,constructor:function(b){this._toConnect={};for(var d in b)this[d]===
u&&(this._toConnect[d.replace(/^on/,"").toLowerCase()]=b[d],delete b[d])},postCreate:function(){this.inherited(arguments);for(var b in this._toConnect)this.on(b,this._toConnect[b]);delete this._toConnect},on:function(b,d){return this[this._onMap(b)]===u?f.connect(this.domNode,b.toLowerCase(),this,d):this.inherited(arguments)},_setFocusedAttr:function(b){this._focused=b;this._set("focused",b)},setAttribute:function(b,d){w.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(b,d)},attr:function(b,d){return 2<=arguments.length||"object"===typeof b?this.set.apply(this,arguments):this.get(b)},getDescendants:function(){w.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?d("[widgetId]",this.containerNode).map(H.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});g("dijit-legacy-requires")&&t(0,function(){require(["dijit/_base"])});
return l})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(l,p,f,c,g,w,k,d,t,H,y,I,z,u,b,x,v,n,J,F,C,S,G){function N(b){return function(B){d[B?
"set":"remove"](this.domNode,b,B);this._set(b,B)}}z.add("dijit-legacy-requires",!u.isAsync);z.add("dojo-bidi",!1);z("dijit-legacy-requires")&&v(0,function(){l(["dijit/_base/manager"])});var K={};c=w("dijit._WidgetBase",[n,C],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:N("lang"),dir:"",_setDirAttr:N("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(b){this._set("ownerDocument",
b)},attributeMap:{},_blankGif:c.blankGif||l.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var b=this.constructor;if(!b._setterAttrs){var d=b.prototype,n=b._setterAttrs=[],b=b._onMap={},c;for(c in d.attributeMap)n.push(c);for(c in d)/^on/.test(c)&&(b[c.substring(2).toLowerCase()]=c),/^_set[A-Z](.*)Attr$/.test(c)&&(c=c.charAt(4).toLowerCase()+c.substr(5,c.length-9),d.attributeMap&&c in d.attributeMap||n.push(c))}},postscript:function(b,d){this.create(b,d)},create:function(d,c){this._introspect();
this.srcNodeRef=k.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);d&&(this.params=d,b.mixin(this,d));this.postMixInProperties();this.id||(this.id=G.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=F.body(this.ownerDocument);G.add(this);
this.buildRendering();var B;this.domNode&&(this._applyAttributes(),(d=this.srcNodeRef)&&d.parentNode&&this.domNode!==d&&(d.parentNode.replaceChild(this.domNode,d),B=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();B&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var b={},d;for(d in this.params||{})b[d]=this._get(d);p.forEach(this.constructor._setterAttrs,function(d){if(!(d in b)){var c=this._get(d);c&&this.set(d,c)}},this);for(d in b)this.set(d,b[d])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var b=this.baseClass.split(" ");this.isLeftToRight()||(b=b.concat(p.map(b,function(b){return b+"Rtl"})));t.add(this.domNode,b)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,p.forEach(this.getChildren(),function(d){d._started||d._destroyed||!b.isFunction(d.startup)||(d.startup(),d._started=!0)}))},destroyRecursive:function(b){this._beingDestroyed=
!0;this.destroyDescendants(b);this.destroy(b)},destroy:function(d){function c(b){b.destroyRecursive?b.destroyRecursive(d):b.destroy&&b.destroy(d)}this._beingDestroyed=!0;this.uninitialize();p.forEach(this._connects,b.hitch(this,"disconnect"));p.forEach(this._supportingWidgets,c);this.domNode&&p.forEach(G.findWidgets(this.domNode,this.containerNode),c);this.destroyRendering(d);G.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?d.remove(this.domNode,"widgetId"):H.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||H.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(b){p.forEach(this.getChildren(),function(d){d.destroyRecursive&&d.destroyRecursive(b)})},uninitialize:function(){return!1},_setStyleAttr:function(d){var c=this.domNode;b.isObject(d)?I.set(c,d):c.style.cssText=c.style.cssText?c.style.cssText+("; "+d):d;this._set("style",d)},_attrToDom:function(c,n,k){k=3<=
arguments.length?k:this.attributeMap[c];p.forEach(b.isArray(k)?k:[k],function(k){var v=this[k.node||k||"domNode"];switch(k.type||"attribute"){case "attribute":b.isFunction(n)&&(n=b.hitch(this,n));k=k.attribute?k.attribute:/^on[A-Z][a-zA-Z]*$/.test(c)?c.toLowerCase():c;v.tagName?d.set(v,k,n):v.set(k,n);break;case "innerText":v.innerHTML="";v.appendChild(this.ownerDocument.createTextNode(n));break;case "textContent":v.textContent=n;break;case "innerHTML":v.innerHTML=n;break;case "class":t.replace(v,
n,this[c]);break;case "toggleClass":t.toggle(v,k.className||c,n)}},this)},get:function(b){var d=this._getAttrNames(b);return this[d.g]?this[d.g]():this._get(b)},set:function(d,c){if("object"===typeof d){for(var n in d)this.set(n,d[n]);return this}n=this._getAttrNames(d);var k=this[n.s];if(b.isFunction(k))var v=k.apply(this,Array.prototype.slice.call(arguments,1));else{var k=this.focusNode&&!b.isFunction(this.focusNode)?"focusNode":"domNode",t=this[k]&&this[k].tagName,g;if((g=t)&&!(g=K[t])){g=this[k];
var w={},f;for(f in g)w[f.toLowerCase()]=!0;g=K[t]=w}f=g;n=d in this.attributeMap?this.attributeMap[d]:n.s in this?this[n.s]:f&&n.l in f&&"function"!=typeof c||/^aria-|^data-|^role$/.test(d)?k:null;null!=n&&this._attrToDom(d,c,n);this._set(d,c)}return v||this},_attrPairNames:{},_getAttrNames:function(b){var d=this._attrPairNames;if(d[b])return d[b];var c=b.replace(/^[a-z]|-[a-zA-Z]/g,function(b){return b.charAt(b.length-1).toUpperCase()});return d[b]={n:b+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",
l:c.toLowerCase()}},_set:function(b,d){var c=this[b];this[b]=d;!this._created||c===d||c!==c&&d!==d||(this._watchCallbacks&&this._watchCallbacks(b,c,d),this.emit("attrmodified-"+b,{detail:{prevValue:c,newValue:d}}))},_get:function(b){return this[b]},emit:function(b,d,c){d=d||{};void 0===d.bubbles&&(d.bubbles=!0);void 0===d.cancelable&&(d.cancelable=!0);d.detail||(d.detail={});d.detail.widget=this;var n,k=this["on"+b];k&&(n=k.apply(this,c?c:[d]));this._started&&!this._beingDestroyed&&x.emit(this.domNode,
b.toLowerCase(),d);return n},on:function(b,d){var c=this._onMap(b);return c?f.after(this,c,d,!0):this.own(x(this.domNode,b,d))[0]},_onMap:function(b){var d=this.constructor,c=d._onMap;if(!c){var c=d._onMap={},n;for(n in d.prototype)/^on/.test(n)&&(c[n.replace(/^on/,"").toLowerCase()]=n)}return c["string"==typeof b&&b.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?G.findWidgets(this.containerNode):
[]},getParent:function(){return G.getEnclosingWidget(this.domNode.parentNode)},connect:function(b,d,c){return this.own(g.connect(b,d,this,c))[0]},disconnect:function(b){b.remove()},subscribe:function(d,c){return this.own(J.subscribe(d,b.hitch(this,c)))[0]},unsubscribe:function(b){b.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():y.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=I.get(this.domNode,"display")},placeAt:function(b,d){var c=
!b.tagName&&G.byId(b);!c||!c.addChild||d&&"number"!==typeof d?(b=c&&"domNode"in c?c.containerNode&&!/after|before|replace/.test(d||"")?c.containerNode:c.domNode:k.byId(b,this.ownerDocument),H.place(this.domNode,b,d),!this._started&&(this.getParent()||{})._started&&this.startup()):c.addChild(this,d);return this},defer:function(d,c){var n=setTimeout(b.hitch(this,function(){n&&(n=null,this._destroyed||b.hitch(this,d)())}),c||0);return{remove:function(){n&&(clearTimeout(n),n=null);return null}}}});z("dojo-bidi")&&
c.extend(S);return c})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(l,p,f){return f("dijit.Destroyable",null,{destroy:function(c){this._destroyed=!0},own:function(){var c=["destroyRecursive","destroy","remove"];l.forEach(arguments,function(g){function f(){d.remove();l.forEach(t,function(d){d.remove()})}var k,d=p.before(this,"destroy",function(d){g[k](d)}),t=[];g.then?(k="cancel",g.then(f,f)):l.forEach(c,function(d){"function"===typeof g[d]&&
(k||(k=d),t.push(p.after(g,d,f,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(l,p,f,c,g,w){l=c("dijit._OnDijitClickMixin",null,{connect:function(c,d,t){return this.inherited(arguments,[c,"ondijitclick"==d?w:d,t])}});l.a11yclick=w;return l})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(l,p,f,c){c.extend(p,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return f("dijit._FocusMixin",null,{_focusManager:l})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(l,p,f,c){f(function(){p("highcontrast")&&l.add(c.body(),"dijit_a11y")});return p})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(l,
p,f,c,g,w,k){g.add("highcontrast",function(){var d=k.doc.createElement("div");try{d.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(p.blankGif||l.toUrl("./resources/blank.gif"))+'");';k.body().appendChild(d);var t=c.getComputedStyle(d),f=t.backgroundImage;return t.borderTopColor==t.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f)}catch(y){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
y.toString()),!1}finally{8>=g("ie")?d.outerHTML="":k.body().removeChild(d)}});w(function(){g("highcontrast")&&f.add(k.body(),"dj_a11y")});return g})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(l){var p=l.getObject("dojox.html.entities",!0),f=function(c,f){var k,d;if(f._encCache&&f._encCache.regexp&&f._encCache.mapper&&f.length==f._encCache.length)k=f._encCache.mapper,d=f._encCache.regexp;else{k={};d=["["];var t;for(t=0;t<f.length;t++)k[f[t][0]]="\x26"+f[t][1]+";",d.push(f[t][0]);
d.push("]");d=new RegExp(d.join(""),"g");f._encCache={mapper:k,regexp:d,length:f.length}}return c=c.replace(d,function(d){return k[d]})},c=function(c,f){var k,d;if(f._decCache&&f._decCache.regexp&&f._decCache.mapper&&f.length==f._decCache.length)k=f._decCache.mapper,d=f._decCache.regexp;else{k={};d=["("];var t;for(t=0;t<f.length;t++){var g="\x26"+f[t][1]+";";t&&d.push("|");k[g]=f[t][0];d.push(g)}d.push(")");d=new RegExp(d.join(""),"g");f._decCache={mapper:k,regexp:d,length:f.length}}return c=c.replace(d,
function(d){return k[d]})};p.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];p.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],
["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],
["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],
["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393",
"Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],
["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044",
"frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],
["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309",
"rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019",
"rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];p.encode=function(c,l){c&&(l?c=f(c,l):(c=f(c,p.html),c=f(c,p.latin)));return c};p.decode=function(f,l){f&&(l?f=c(f,l):(f=c(f,p.html),f=c(f,p.latin)));return f};return p})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(l,p,f,c){var g=function(c,
d){return c-d},w={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var d=String(c),f=d.match(w._reNumber);c={integer:0,fractional:0};f&&f[1]?(c.integer=f[1].split("").length,c.fractional=f[3]?f[3].split("").length:0):-1<d.toLowerCase().indexOf("e")&&(f=d.split("e"),d=f[0],f=f[1],d&&f&&(d=Number(d),f=Number(f),(c=0<f)||(f=Math.abs(f)),d=w.getDigits(d),c?(d.integer+=f,d.fractional=f>d.fractional?0:d.fractional-f):(d.fractional+=f,d.integer=f>d.integer?1:d.integer-f),c=d));return c},getFixedNumbers:function(c,
d){var f;f=Number(c.toFixed(d));f<c?c=f+1/Math.pow(10,d):(c=f,f-=1/Math.pow(10,d));f=Number(f.toFixed(d));c=Number(c.toFixed(d));return[f,c]},getPctChange:function(c,d,f,g){var k={prev:null,next:null},l;null!=f&&(l=c-f,k.prev=Math.floor(Math.abs(100*(d-f-l)/l)));null!=g&&(l=g-c,k.next=Math.floor(Math.abs(100*(g-d-l)/l)));return k},round:function(c,d){c=c.slice(0);var f,k,l,p,z,u,b,x,v=d&&null!=d.tolerance?d.tolerance:2,n=d&&d.indexes,J=d&&null!=d.strictBounds?d.strictBounds:!1;if(n)n.sort(g);else for(n=
[],z=0;z<c.length;z++)n.push(z);for(z=0;z<n.length;z++)if(x=n[z],d=c[x],f=0===x?null:c[x-1],k=x===c.length-1?null:c[x+1],l=w.getDigits(d),l=l.fractional){u=0;for(b=!1;u<=l&&!b;)p=w.getFixedNumbers(d,u),p=J&&0===z?p[1]:p[0],b=w.hasMinimalChange(d,p,f,k,v),u++;b&&(c[x]=p)}return c},hasMinimalChange:function(c,d,f,l,g){c=w.getPctChange(c,d,f,l);d=null==c.prev||c.prev<=g;f=null==c.next||c.next<=g;return d&&f||c.prev+c.next<=2*g},_reAllZeros:new RegExp("\\"+f.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,
format:function(c,d){d=d||{places:20,round:-1};(c=p.format(c,d))&&(c=c.replace(w._reSomeZeros,"$1").replace(w._reAllZeros,""));return c}};l("extend-esri")&&(c.numberUtils=w);return w})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(l,p,f,c,g,w,k,d){function t(b){return b&&p.map(b,function(b){return new k(b)})}function H(b,c,d){var f="";0===c?f=I.lt+" ":c===
d&&(f=I.gt+" ");return f+b}var y={},I={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},z={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},u={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",
dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},b={formatLength:"short",fullYear:!0},x={formatLength:"short"};l.mixin(y,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(f,n){var v=[];null==f||f instanceof Date||(f=new Date(f));n=n||{};n=l.mixin({},n);var k=n.selector?n.selector.toLowerCase():null,g=!k||-1<k.indexOf("time"),k=!k||-1<k.indexOf("date");
g&&(n.timeOptions=n.timeOptions||x,n.timeOptions&&(n.timeOptions=l.mixin({},n.timeOptions),n.timeOptions.selector=n.timeOptions.selector||"time",v.push(n.timeOptions)));k&&(n.dateOptions=n.dateOptions||b,n.dateOptions&&(n.dateOptions=l.mixin({},n.dateOptions),n.dateOptions.selector=n.dateOptions.selector||"date",v.push(n.dateOptions)));v&&v.length?(v=p.map(v,function(b){return c.format(f,b)}),n=1==v.length?v[0]:d["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(b,c){return v[c]})):
n=c.format(f);return n},createColorStops:function(b){var c=b.values,d=b.colors,f=b.labelIndexes,v=b.isDate,k=b.dateFormatOptions;b=[];return b=p.map(c,function(b,n){var g=null;if(!f||-1<p.indexOf(f,n)){var l;(l=v?y.formatDate(b,k):w.format(b))&&(g=H(l,n,c.length-1))}return{value:b,color:d[n],label:g}})},updateColorStops:function(b){var c=b.stops,d=b.changes,f=b.isDate,k=b.dateFormatOptions,v=[],g,l=p.map(c,function(b){return b.value});p.forEach(d,function(b){v.push(b.index);l[b.index]=b.value});g=
w.round(l,{indexes:v});p.forEach(c,function(b,d){b.value=l[d];if(null!=b.label){var n,v=null;(n=f?y.formatDate(g[d],k):w.format(g[d]))&&(v=H(n,d,c.length-1));b.label=v}})},createClassBreakLabel:function(b){var c=b.minValue,d=b.maxValue,f=b.isFirstBreak?"":I.gt+" ";b="percent-of-total"===b.normalizationType?I.pct:"";c=null==c?"":w.format(c);d=null==d?"":w.format(d);return f+c+b+" \u2013 "+d+b},setLabelsForClassBreaks:function(b){var c=b.classBreaks,d=b.classificationMethod,f=b.normalizationType,k=
[];c&&c.length&&("standard-deviation"===d?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):b.round?(k.push(c[0].minValue),p.forEach(c,function(b){k.push(b.maxValue)}),k=w.round(k),p.forEach(c,function(b,c){b.label=y.createClassBreakLabel({minValue:0===c?k[0]:k[c],maxValue:k[c+1],isFirstBreak:0===c,normalizationType:f})})):p.forEach(c,function(b,c){b.label=y.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===
c,normalizationType:f})}))},updateClassBreak:function(b){var c=b.classBreaks,d=b.normalizationType,f=b.change,k=f.index,f=f.value,g=-1,l=-1,v=c.length;"standard-deviation"===b.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===k?g=k:k===v?l=k-1:(l=k-1,g=k),-1<g&&g<v&&(b=c[g],b.minValue=f,b.label=y.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===g,normalizationType:d})),-1<l&&
l<v&&(b=c[l],b.maxValue=f,b.label=y.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===l,normalizationType:d})))},calculateDateFormatInterval:function(b){var c,d,f=b.length,k,g,l,v,t,u,w=Infinity,x;b=p.map(b,function(b){return new Date(b)});for(c=0;c<f-1;c++){k=b[c];l=[];t=Infinity;u="";for(d=c+1;d<f;d++)g=b[d],g=k.getFullYear()!==g.getFullYear()&&"year"||k.getMonth()!==g.getMonth()&&"month"||k.getDate()!==g.getDate()&&"day"||k.getHours()!==g.getHours()&&"hour"||k.getMinutes()!==
g.getMinutes()&&"minute"||k.getSeconds()!==g.getSeconds()&&"second"||"millisecond",v=z[g],v<t&&(t=v,u=g),l.push(g);t<w&&(w=t,x=u)}return x},createUniqueValueLabel:function(b){var c=b.value,d=b.fieldInfo,f=b.domain;b=b.dateFormatInterval;var k=String(c);(f=f&&f.codedValues?f.getName(c):null)?k=f:"number"===typeof c&&(k=d&&"esriFieldTypeDate"===d.type?y.formatDate(c,b&&u[b]):w.format(c));return k},cloneColorInfo:function(b){var c;b&&(c=l.mixin({},b),c.colors=t(c.colors),c.stops=c.stops&&p.map(c.stops,
function(b){b=l.mixin({},b);b.color&&(b.color=new k(b.color));return b}),c.legendOptions&&(c.legendOptions=l.mixin({},c.legendOptions)));return c},cloneOpacityInfo:function(b){var c;if(b){c=l.mixin({},b);if(b=c.opacityValues)c.opacityValues=b.slice(0);if(b=c.stops)c.stops=p.map(b,function(b){return l.mixin({},b)});if(b=c.legendOptions)c.legendOptions=l.mixin({},b)}return c},cloneSizeInfo:function(b){var c;b&&(c=l.mixin({},b),c.stops&&(c.stops=p.map(c.stops,function(b){return l.mixin({},b)})),(b=c.minSize)&&
"object"===typeof b&&(c.minSize=y.cloneSizeInfo(b)),(b=c.maxSize)&&"object"===typeof b&&(c.maxSize=y.cloneSizeInfo(b)),b=c.legendOptions)&&(c.legendOptions=l.mixin({},b),b=b.customValues)&&(c.legendOptions.customValues=b.slice(0));return c},getClassCodesForRelationship:function(){return l.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return l.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1",
"HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});f("extend-esri")&&l.setObject("renderer.utils",y,g);return y})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(l,p,f,c,g,w){return l([w,g],{_onMap:function(c){var d=this.constructor._onMap,f;d&&d.FINAL||(delete this.constructor._onMap,d=this.registerConnectEvents(),d.FINAL=!0);c=c.toLowerCase();d[c]?
f=this[d[c].method]:(c=this._onCamelCase(c),this[c]&&(f=c));return f},on:function(f,d){var k=this._onMap(f),g=f.replace(/\-/g,""),l="on"+g in this.domNode;return k||!l?this.inherited(arguments):this.own(c(this.domNode,g,d))[0]},emit:function(c,d,f){var k,g,l,t=c.toLowerCase(),u=this.constructor._onMap||this.registerConnectEvents();g=this[this._onMap(t)];d=d||{};d.target||(d.target=this);g&&u&&u[t]&&(this._onObj2Arr(function(){k=Array.prototype.slice.call(arguments)},u[t].argKeys)(d),l=p.mixin({},
arguments),l[2]=k,l[0]=u[t].name.replace(/^on/,""));return this.inherited(l||arguments)}})})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(l,
p,f,c,g,w,k,d,t,H,y,I,z,u,b,x,v,n,J,F,C,S,G,N,K,B,O,fa,ga,ha,ia,ja,ka,T,la,X,U,Y,Z,R,aa,ba,V){var ca=O.getClassValuesForRelationship(),da={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},W={HH:315,HL:45,LL:135,LH:225},M=p([ba,n],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new k([64,64,64]),
defaultText:"Aa",sizeRampLightColor:new k([255,255,255]),sizeRampDarkColor:new k([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,e){f.mixin(this,V.widgets.legend);this._i18n=V.widgets.legend;a=a||{};a.map?e?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?
!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===M.ALIGN_RIGHT?M.ALIGN_RIGHT:M.ALIGN_LEFT,this.arrangement===M.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=d(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);
var a=["ar","he"],e,b;for(e=0;e<a.length;e+=1)b=a[e],l.locale&&-1!==l.locale.indexOf(b)&&(-1!==l.locale.indexOf("-")?-1!==l.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();
9>t("ie")&&(this._repaintItems=f.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||c.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],c.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)b.destroy(this.domNode.children[a]);
this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],c.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),
a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],e=[];c.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);var m;this._isSupportedLayerType(b)&&(b.arcgisProps&&b.arcgisProps.title&&(b._titleForLegend=b.arcgisProps.title),this.layers.push(b));"esri.layers.KMLLayer"==b.declaredClass&&(m=b.getLayers(),c.forEach(m,function(e){a.push(e.id)},this));"esri.layers.GeoRSSLayer"==
b.declaredClass&&(m=b.getFeatureLayers(),c.forEach(m,function(a){e.push(a.id)},this))},this);c.forEach(this.map.graphicsLayerIds,function(b){var m=this.map.getLayer(b);-1==c.indexOf(a,b)&&-1==c.indexOf(e,b)&&this._isSupportedLayerType(m)&&this._isLayerDrawingEnabled(m)&&(m.arcgisProps&&m.arcgisProps.title&&(m._titleForLegend=m.arcgisProps.title),this.layers.push(m))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&(a._params&&a._params.drawMode||a.isFeatureReductionActive&&
a.isFeatureReductionActive())},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=g.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=g.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=g.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=g.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),c.forEach(this.layers,function(a){var e={};
e.oarcConnect=g.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers");e.oaicConnect=g.connect(a,"onFeatureReductionChange",this,"_refreshLayers");e.ovcConnect=g.connect(a,"onVisibilityChange",this,"_refreshLayers");e.oocConnect=g.connect(a,"onOpacityChange",this,"_refreshLayers");e.oscConnect=g.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(e.odcConnect=g.connect(a,"_onDynamicLayersChange",
f.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(e.oirConnect=g.connect(a,"onRenderingChange",f.partial(this._updateImageServiceLayers,this,a)),e.oivrConnect=g.connect(a,"onRendererChange",f.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(e.oivrConnect=g.connect(a,"onRendererChange",f.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=e},this))},_deactivate:function(){this._ozeConnect&&
g.disconnect(this._ozeConnect);this._olaConnect&&g.disconnect(this._olaConnect);this._olroConnect&&g.disconnect(this._olroConnect);this._olrConnect&&g.disconnect(this._olrConnect);c.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.oarcConnect&&g.disconnect(a.oarcConnect);a.oaicConnect&&g.disconnect(a.oaicConnect);a.ovcConnect&&g.disconnect(a.ovcConnect);a.oocConnect&&g.disconnect(a.oocConnect);a.oscConnect&&g.disconnect(a.oscConnect);a.odcConnect&&g.disconnect(a.odcConnect);a.oirConnect&&
g.disconnect(a.oirConnect);a.oivrConnect&&g.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,e){delete e.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];c.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);c.forEach(this.map.graphicsLayerIds,
function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,e=!1;x.set(this.domNode,"position","relative");b.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var m=[];c.forEach(this.layers,function(h){if("esri.layers.KMLLayer"==h.declaredClass||"esri.layers.GeoRSSLayer"==h.declaredClass){var q;h.loaded?("esri.layers.KMLLayer"==
h.declaredClass?q=h.getLayers():"esri.layers.GeoRSSLayer"==h.declaredClass&&(q=h.getFeatureLayers(),this.hideLayersInLegend[h.id]&&(q=c.filter(q,function(a){return-1==c.indexOf(this.hideLayersInLegend[h.id],a.id)},this))),c.forEach(q,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&h._titleForLegend&&(a._titleForLegend=h._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==
a.geometryType&&(a._titleForLegend+=this.NLS_areas),m.push(a))},this)):g.connect(h,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===h.declaredClass)if(!h.loaded)g.connect(h,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&h.visible)&&0<h.layerInfos.length&&c.some(h.layerInfos,function(a){return a.legendURL})){var d=!1;c.forEach(h.layerInfos,function(e){if(e.legendURL&&-1<
c.indexOf(h.visibleLayers,e.name)){d||(b.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(h._titleForLegend||h.name||h.id)+"\x3c/span\x3e"},this.domNode),d=!0);var m;e=e.legendURL;if(h.customParameters||h.customLayerParameters){var q=f.clone(h.customParameters||{});f.mixin(q,h.customLayerParameters||{});for(m in q)e+=(-1===e.indexOf("?")?"?":"\x26")+m+"\x3d"+q[m]}b.create("div",{innerHTML:"\x3cimg src\x3d'"+e+"'/\x3e"},this.domNode);a=!0}},this)}}else"esri.layers.WFSLayer"!==
h.declaredClass||h.renderer?m.push(h):(q=b.create("div",{id:this.id+"_"+h.id,"class":"esriLegendService"}),b.create("span",{innerHTML:this._getServiceTitle(h),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},q))))),b.place(q,this.id,"first"),q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},q),q=b.create("tbody",{},q),"esriGeometryComplex"===h.geometryType?(this._buildRow_Renderer(h,
h._pointSymbol,null,this.NLS_points,null,q),this._buildRow_Renderer(h,h._lineSymbol,null,this.NLS_lines,null,q),this._buildRow_Renderer(h,h._polygonSymbol,null,this.NLS_areas,null,q)):"esriGeometryPoint"===h.geometryType?this._buildRow_Renderer(h,h._pointSymbol,null,"",null,q):"esriGeometryPolyline"===h.geometryType?this._buildRow_Renderer(h,h._lineSymbol,null,"",null,q):"esriGeometryPolygon"===h.geometryType&&this._buildRow_Renderer(h,h._polygonSymbol,null,"",null,q),e=!0)},this);var q=[];c.forEach(m,
function(a){if(!a.loaded)var e=g.connect(a,"onLoad",this,function(a){g.disconnect(e);e=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var c=b.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",
{},b.create("table",{width:"95%"},c)))));b.place(c,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass?this._createLegendForLayer(a):this.isHostedTileService(a)?this._getLayerInfos(a).then(f.hitch(this,function(a){this._createLegendForLayer(a)}),f.hitch(this,function(a){q.push(this._legendRequest(a))})):q.push(this._legendRequest(a))}},this);0!==q.length||a||e?(new I(q)).addCallback(f.hitch(this,function(b){a||e?u.byId(this.id+"_msg").innerHTML=
"":u.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(u.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer||this.isHostedTileService(a)){var e=!1;if(a.legendResponse||this.isHostedTileService(a)){var b=a.dynamicLayerInfos||a.layerInfos;b&&b.length?c.forEach(b,function(b,m){this.hideLayersInLegend[a.id]&&-1!==c.indexOf(this.hideLayersInLegend[a.id],b.id)||(b=this._buildLegendItems(a,b,m),e=e||b)},
this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(e=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(b=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,e=this._buildLegendItems(a,{id:b,name:null,subLayerIds:null,parentLayerId:-1},0));e&&(x.set(u.byId(this.id+"_"+a.id),"display","block"),x.set(u.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):
this._legendRequestTools(a);g.connect(a,"onLoad",f.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var e=a.url,b=e.indexOf("?"),e=-1<b?e.substring(0,b)+"/legend"+e.substring(b):e+"/legend";(b=a._getToken())&&(e+="?token\x3d"+b);var q=f.hitch(this,"_processLegendResponse"),h={f:"json"};a._params.dynamicLayers&&(h.dynamicLayers=z.stringify(this._createDynamicLayers(a)),"[{}]"===h.dynamicLayers&&(h.dynamicLayers="[]"));a._params.bandIds&&(h.bandIds=a._params.bandIds);a._params.renderingRule?
h.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&c.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(h.renderingRule=z.stringify({rasterFunction:a.name}))});return N({url:e,content:h,callbackParamName:"callback",load:function(e,b){q(a,e,b)},error:G.defaults.io.errorHandler})},_legendRequestTools:function(a){var e=a.url.toLowerCase().indexOf("/rest/"),e=a.url.substring(0,e)+a.url.substring(e+5,a.url.length),e=this._legendUrl+
"?soapUrl\x3d"+window.escape(e);if(!t("ie")||8<t("ie"))e+="\x26returnbytes\x3dtrue";var b=f.hitch(this,"_processLegendResponse");return N({url:e,content:{f:"json"},callbackParamName:"callback",load:function(e,c){b(a,e,c)},error:G.defaults.io.errorHandler})},_processLegendResponse:function(a,e){e&&e.layers?(a.legendResponse=e,u.byId(this.id+"_"+a.id)&&b.empty(u.byId(this.id+"_"+a.id)),b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},
b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},u.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+w.toJson(e))},_buildLegendItems:function(a,e,m){var q=!1,h=u.byId(this.id+"_"+a.id),d=e.parentLayerId;if(e.subLayerIds)a=b.create("div",{id:this.id+"_"+a.id+"_"+e.id+"_group",style:{display:"none"},"class":-1==d?0<m?"esriLegendGroupLayer":"":this._legendAlign},-1==d?h:u.byId(this.id+"_"+a.id+"_"+d+"_group")),b.create("td",
{innerHTML:C.encode(e.name),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(m=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===c.indexOf(a.visibleLayers,e.id))return q}else{if(m=this._getReallyVisibleLayers(m,a.visibleLayers),-1===c.indexOf(m,e.id))return q}else if(-1===c.indexOf(a.visibleLayers,e.id))return q;h=b.create("div",{id:this.id+"_"+a.id+
"_"+e.id,style:{display:"none"},"class":-1<d?this._legendAlign:""},-1==d?h:u.byId(this.id+"_"+a.id+"_"+d+"_group"));b.create("td",{innerHTML:C.encode(e.name)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},h))));m=a.dynamicLayerInfos||a.layerInfos;d=!1;m&&m.length&&(d=c.some(m,function(a){return!!a.drawingInfo}));if(a.legendResponse)q=q||this._buildLegendItems_Tools(a,e,h);else if(a.renderer||d)q=q||this._buildLegendItems_Renderer(a,
e,h)}return q},_getReallyVisibleLayers:function(a,e){if(!a||!e||!e.length)return[];var b=[],q=[],h;for(h=0;h<a.length;h++)if(a[h].subLayerIds){if(-1===c.indexOf(e,a[h].id)||-1<c.indexOf(q,a[h].id))q=q.concat(a[h].subLayerIds)}else-1<c.indexOf(e,a[h].id)&&-1===c.indexOf(q,a[h].id)&&b.push(a[h].id);return b},_buildLegendItems_Tools:function(a,e,m){var q=e.parentLayerId,h=this.map.getScale(),d=!1,f=function(a,e){var b,c;for(b=0;b<a.length;b++)if(e.dynamicLayerInfos)for(c=0;c<e.dynamicLayerInfos[c].length;c++){if(e.dynamicLayerInfos[c].mapLayerId==
a[b].layerId)return a[b]}else if(e.id==a[b].layerId)return a[b];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,e,h)){var k=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var g=this._getEffectiveScale(a,e);if(g.minScale&&g.minScale<h||g.maxScale&&g.maxScale>h)k=!1}if(k){var h=f(a.legendResponse.layers,e),A=h.legendType,r=h.layerType,l=h.legend;
if(l){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,h,e);m=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m);var n=b.create("tbody",{},m);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,e);var p=[];c.forEach(l,function(b){if(!(10.1<=a.version&&!b.values&&1<l.length)||!a._hideDefaultSymbol&&"\x3call other values\x3e"!==b.label&&(b.label||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||
"Raster Layer"===r)){var h=b.label;if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)d=!0,h&&-1!==c.indexOf(p,h)||(p.push(h),this._buildRow_Tools(b,n,a,e.id,A))}},this)}}}d&&(x.set(u.byId(this.id+"_"+a.id+"_"+e.id),"display","block"),-1<q&&(x.set(u.byId(this.id+"_"+a.id+"_"+q+"_group"),"display","block"),this._findParentGroup(a.id,a,q)));return d},_getLayerInfos:function(a){var e=new y,b=a.dynamicLayerInfos||a.layerInfos;if(b&&b.length)if(c.some(b,function(a){return!!a.drawingInfo}))e.resolve(a);
else{var q=a.url,h=q.indexOf("?"),q=-1==h?q+"/layers":q.substring(0,h)+"/layers"+q.substring(h,q.length);N({url:q,content:{f:"json"},callbackParamName:"callback",load:function(h,m){h.layers?(c.forEach(b,function(a){var e=c.filter(h.layers,function(e){return a.source?e.id===a.source.mapLayerId:e.id===a.id});e&&e[0]&&e[0].drawingInfo&&(a.drawingInfo=e[0].drawingInfo,a.fields=e[0].fields)}),e.resolve(a)):e.reject(a)},error:function(b){e.reject(a)}})}return e},_sanitizeLegendResponse:function(a,e,b){var m=
e.legend;if(10.1<=a.version&&1<m.length&&!e._sanitized){a=f.getObject("layerDefinition.drawingInfo.renderer",!1,b);var h,d;a||(a=f.getObject("drawingInfo.renderer",!1,b));c.some(m,function(a){if(a.values)return!0})&&c.some(m,function(a,e){a.values||(d=e,h=a);return!!h});a?"uniqueValue"===a.type?h&&(m.splice(d,1),m.push(h)):"classBreaks"===a.type&&(h&&m.splice(d,1),m.reverse(),h&&m.push(h)):h&&(m.splice(d,1),m.push(h));e._sanitized=!0}},_buildRow_Tools:function(a,e,c,d,h){var m=b.create("tr",{},e),
q;this.alignRight?(e=b.create("td",{align:this._isRightToLeft?"left":"right"},m),q=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},m)):(q=b.create("td",{width:35,align:"center"},m),e=b.create("td",{},m));m=a.url;(!t("ie")||9<=t("ie")||9>t("ie")&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&a.imageData&&0<a.imageData.length?m="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(m=c.url+"/"+d+"/images/"+a.url,(d=c._getToken())&&(m+="?token\x3d"+d));d=b.create("img",
{src:m,border:0,style:"opacity:"+c.opacity},q);a=b.create("td",{innerHTML:C.encode(a.label),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%",dir:"ltr"},e))));h&&"Stretched"===h&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",d.style.marginBottom="-1px",d.style.display="block",e.style.verticalAlign="top");9>t("ie")&&(d.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(a,
e,b){var c;a&&(c=(a=a.getVisualVariablesForType(e,b))&&a[0]);return c},_getVariables:function(a,e,b){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return e?c.filter(a,function(a){return!(!a||a.field!==e||a.normalizationField!=b)}):a},_getFieldAlias:function(a,e,b){var c=e.infoTemplate||(e.infoTemplates&&b&&e.infoTemplates[b.id]?e.infoTemplates[b.id].infoTemplate:null),c=c&&c.getFieldInfo&&c.getFieldInfo(a);a=f.isFunction(a)?null:this.getField(e,
a,b);e=c||a;b="";e&&(b=c&&c.label||a&&a.alias||e.name||e.fieldName);return b},_getDomainName:function(a,b,c,d){var e;a&&!f.isFunction(a)&&(e=(c=(a=this.getField(c,a,d))&&c.getDomain?c.getDomain(a.name):null)&&c.codedValues?c.getName(b):null);return e},_getRampTitle:function(a,b,c){var e,h=a.field,d=a.normalizationField,m=!1,g=!1,k=!1,h=f.isFunction(h)?null:h,d=f.isFunction(d)?null:d;if(a.legendOptions&&a.legendOptions.title)e=a.legendOptions.title;else if(a.valueExpressionTitle)e=a.valueExpressionTitle;
else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var A=b.renderer.authoringInfo.visualVariables;for(a=0;a<A.length;a++){var r=A[a];if("colorInfo"===r.type&&"ratio"===r.style){m=!0;break}else if("colorInfo"===r.type&&"percent"===r.style){g=!0;break}else if("colorInfo"===r.type&&"percentTotal"===r.style){k=!0;break}}}(m=k&&"showRatioPercentTotal"||g&&"showRatioPercent"||m&&"showRatio"||d&&"showNormField"||h&&"showField"||null)&&(e=K.substitute({field:h&&this._getFieldAlias(h,
b,c),normField:d&&this._getFieldAlias(d,b,c)},"showField"===m?"${field}":this._i18n[m]))}return e},_getRendererTitle:function(a,b,c){var e;if(a){var d,m,g;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(d=a.attributeField,m=a.normalizationField,g="percent-of-total"===a.normalizationType);d=f.isFunction(d)?null:d;m=f.isFunction(m)?null:m;a.legendOptions&&a.legendOptions.title?e=a.legendOptions.title:a.valueExpressionTitle?e=a.valueExpressionTitle:(a=m&&"showNormField"||(g?"showNormPct":null)||
d&&"showField"||null)&&(e=K.substitute({field:d&&this._getFieldAlias(d,b,c),normField:m&&this._getFieldAlias(m,b,c)},"showField"===a?"${field}":this._i18n[a]))}return e},_buildLegendItems_Renderer:function(a,e,d){var m=e.parentLayerId,h=this.map,g=h.getScale(),k,l=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,e,g)){var D,A,r,n,p,t,w,v,y;r="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:e&&e.drawingInfo?aa.fromJson(f.clone(e.drawingInfo.renderer)):a.isFeatureReductionActive&&
a.isFeatureReductionActive()?a.getFeatureReductionRenderer():a.renderer;if("esri.renderer.ScaleDependentRenderer"===r.declaredClass&&(r=(h="zoom"===r.rangeType?r.getRendererInfoByZoom(h.getZoom()):r.getRendererInfoByScale(g))&&h.renderer,!r))return!1;y=r&&r.authoringInfo&&"relationship"===r.authoringInfo.type;var E=this._getVariables(r),z=c.filter(E,function(a){return!!a}).length,g=E[0],h=E[1],E=E[2],B,I,G,H,F;g&&(n=this._getMedianColor(r,g),g.field&&(t=f.isFunction(g.field)?null:this.getField(a,
g.field,e)),B=!(g.legendOptions&&!1===g.legendOptions.showLegend));h&&(h.field&&(v=f.isFunction(h.field)?null:this.getField(a,h.field,e)),I=!(h.legendOptions&&!1===h.legendOptions.showLegend));E&&(E.field&&(w=f.isFunction(E.field)?null:this.getField(a,E.field,e)),G=!(E.legendOptions&&!1===E.legendOptions.showLegend));if("esri.renderer.HeatmapRenderer"===r.declaredClass)k=l=!0,this._showHeatRamp(a,e,r,d);else if("esri.renderer.DotDensityRenderer"===r.declaredClass)k=l=!0,this._showDotDensityLegend(a,
e,r,d);else if("esri.renderer.TemporalRenderer"===r.declaredClass)k=l=!0,A=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),D=b.create("tbody",{},A),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(A,a,e),r.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===r.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(a,r.latestObservationRenderer.symbol,n,C.encode(r.latestObservationRenderer.label)||this.NLS_currentObservations,null,D),
r.observationRenderer&&"esri.renderer.SimpleRenderer"===r.observationRenderer.declaredClass&&this._buildRow_Renderer(a,r.observationRenderer.symbol,n,C.encode(r.observationRenderer.label)||this.NLS_previousObservations,null,D);else if("esri.renderer.UniqueValueRenderer"===r.declaredClass){if(r.infos&&0<r.infos.length){k=l=!0;if(r.legendOptions&&r.legendOptions.title||r.valueExpressionTitle)A=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),D=b.create("tbody",
{},A),z=r.legendOptions&&r.legendOptions.title?r.legendOptions.title:r.valueExpressionTitle,this._buildRow_Renderer(a,null,n,C.encode(z),null,D);A=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);D=b.create("tbody",{},A);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(A,a,e);r.attributeField&&E&&this._addSubHeader(D,this._getFieldAlias(r.attributeField,a,e));if(y){var L=r.authoringInfo;F=L.focus;var z=L.numClasses,J=L.field1.field;A=L.field2.field;if(z&&
J&&A){var P=L.field1.normalizationField,L=L.field2.normalizationField,M=P&&this._i18n.showNormField||J&&"${field}",N=L&&this._i18n.showNormField||A&&"${field}",J=K.substitute({field:this._getFieldAlias(J,a,e),normField:P&&this._getFieldAlias(P,a,e)},M);A=K.substitute({field:this._getFieldAlias(A,a,e),normField:L&&this._getFieldAlias(L,a,e)},N);P={shapeDescriptor:da,rotation:this._getRotationAngleForFocus(F)||0};this._buildRow_Renderer(a,null,null,C.encode(J),null,D,null,P);P.rotation+=90;this._buildRow_Renderer(a,
null,null,C.encode(A),null,D,null,P);this._drawRelationshipLegend(d,{numClasses:z,focus:F,uvInfos:r.infos})}}else{var O=[];c.forEach(r.infos,function(b){var d=null;this._isLayerEditable(a)&&a.types&&(d=this._getTemplateFromTypes(a.types,b.value));var h=b.label;null==h&&(h=this._getDomainName(r.attributeField,b.value,a,e)||b.value);-1===c.indexOf(O,h)&&(O.push(h),this._buildRow_Renderer(a,b.symbol,n,C.encode(h),d,D))},this)}}F=!y&&this._displayDefaultSymbol(a,r,d)}else if("esri.renderer.ClassBreaksRenderer"===
r.declaredClass){if(r.infos&&0<r.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)k=l=!0,H=this._isUnclassedRenderer(r),g||1!==r.infos.length||(p=(p=r.infos[0])&&p.symbol),H||(A=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),D=b.create("tbody",{},A),z=this._getRendererTitle(r,a,e),this._buildRow_Renderer(a,null,n,C.encode(z),null,D)),A=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),D=b.create("tbody",
{},A),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(A,a,e),H&&E&&G||(y=r.infos.slice(0).reverse(),c.forEach(y,function(b){var e=b.label;null!=e||H||(e=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,n,C.encode(e),null,D)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==T.STYLE_SCALAR&&a.renderer.style!==T.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(a,r.defaultSymbol,null,"",null,D),a._hideDefaultSymbol=!0);H||(F=this._displayDefaultSymbol(a,
r,d))}else"esri.renderer.SimpleRenderer"===r.declaredClass&&(k=l=!0,A=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),D=b.create("tbody",{},A),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(A,a,e),p=null,this._isLayerEditable(a)&&a.templates&&0<a.templates.length&&(p=a.templates[0]),y=1<z?null:t&&B||v&&I||w&&G,this._buildRow_Renderer(a,r.symbol,n,C.encode(y?this._getRampTitle(1<z?null:g||h||E,a,e):r.label),p,D),p=g?null:r.symbol,y&&(t=v=w=null));k&&
(g&&B&&(g.field||g.valueExpression)&&this._showGradientRamp(a,e,r,null,d,g,t,null,E&&G?!0:!1),E&&G&&(E.field||E.valueExpression)&&(k=g&&B||"esri.renderer.UniqueValueRenderer"===r.declaredClass?!1:!0,this._showSizeLegend(a,e,r,E,n,d,w,null,k)),h&&I&&(h.field||h.valueExpression)&&this._showGradientRamp(a,e,r,p&&!p.url&&p.color?p.color:this.transparencyRampColor,d,h,v,null,!1));F||H&&!B&&!G&&!I||(F=this._displayDefaultSymbol(a,r,d));l=l||F}l&&(x.set(u.byId(this.id+"_"+a.id+"_"+e.id),"display","block"),
-1<m&&(x.set(u.byId(this.id+"_"+a.id+"_"+m+"_group"),"display","block"),this._findParentGroup(a.id,m)));return l},_isLayerEditable:function(a){return"function"===typeof a.isEditable&&a.isEditable()},_isUnclassedRenderer:function(a,b){var e;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){e=a.attributeField;var c=a.normalizationField;e=b?e===b:!!this._getVariables(a,e,c).length}return e},_displayDefaultSymbol:function(a,e,c){var d;!a._hideDefaultSymbol&&e.defaultSymbol&&
(d=!0,c=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),c=b.create("tbody",{},c),this._buildRow_Renderer(a,e.defaultSymbol,null,C.encode(e.defaultLabel)||"others",null,c));return d},_showGradientRamp:function(a,e,c,d,h,g,k,l,n){n=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(n?"":" esriLegendSubFragment")},h);h=b.create("tbody",{},n);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(n,a,e,l);(k||g.valueExpression||
g.legendOptions&&g.legendOptions.title)&&this._addSubHeader(h,this._getRampTitle(g,a,e));k=g.field;var m;k&&(m=f.isFunction(k)?null:this.getField(a,k,e));(e=this._getRampStops(c,g,d,m&&"esriFieldTypeDate"===m.type))&&e.length&&this._drawGradientRamp(h,e,!0,a,this._getRampBorderColor(c),!!d)},_getMedianColor:function(a,b){var e,c;b.colors?(e=b.minDataValue,c=b.maxDataValue):b.stops&&(e=b.stops[0].value,c=b.stops[b.stops.length-1].value);return a.getColor(e+(c-e)/2,{colorInfo:b})},_getRampStops:function(a,
b,d,q){var e,m,f,g,l=!1;b.colors||b.opacityValues?(m=b.maxDataValue-b.minDataValue,e=c.map([0,.25,.5,.75,1],function(a){f=b.minDataValue+a*m;return Number(f.toFixed(6))}),this._checkPrecision(0,4,e)):b.stops&&(e=c.map(b.stops,function(a){return a.value}),(l=c.some(b.stops,function(a){return!!a.label}))&&(g=c.map(b.stops,function(a){return a.label})));var A=e[0],r,n;m=e[e.length-1]-A;return c.map(e,function(c,h){d?(r=new k(d.toRgba()),n=a.getOpacity(c,{opacityInfo:b}),null!=n&&(r.a=n)):r=a.getColor(c,
{colorInfo:b});var f="";if(l)f=g[h];else{var f=q?O.formatDate(c,O.timelineDateFormatOptions):B.format(c),D="";0===h?D=this._specialChars.lt+" ":h===e.length-1&&(D=this._specialChars.gt+" ");f=D+f}return{value:c,color:r,offset:1-(c-A)/m,label:f}},this).reverse()},_checkPrecision:function(a,b,c){var e=a+(b-a)/2,d=c[a],m=c[e],f=c[b],g=Math.floor(d),k=Math.floor(m),l=Math.floor(f);g===d&&l===f&&k!==m&&g!==k&&l!==k&&(c[e]=k);a+1!==e&&this._checkPrecision(a,e,c);e+1!==b&&this._checkPrecision(e,b,c)},_getRampBorderColor:function(a){var b;
if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,e,d,q,h,f){var m=b.create("tr",{},a),g,l,n,r,p,Q=e.length-1,u;r=0;this.alignRight?(a=b.create("td",{align:this._isRightToLeft?"left":"right"},m),g=b.create("td",{align:this._isRightToLeft?"left":"right",
width:this.gradientWidth},m)):(g=b.create("td",{width:this.gradientWidth,align:"center"},m),a=b.create("td",{},m));m=h&&0<h.a&&!(240<=h.r&&240<=h.g&&240<=h.b);l=b.create("div",{"class":m?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},g);g=b.create("div",{"class":"esriLegendColorRamp"+(f?" esriLegendTransparencyRamp":"")},l);f=x.get(g,"width");m&&(h=9>t("ie")?h.toHex():"rgba("+h.toRgba().join(",")+")",x.set(g,"border",this.colorRampBorder+" "+h));d?
(h=this.gradientHeight*Q,x.set(g,"height",h+"px")):h=x.get(g,"height");x.set(l,"height",h+"px");m=J.createSurface(g,f,h);9>t("ie")&&(r=m.getEventSource(),x.set(r,"position","relative"),x.set(r.parentNode,"position","relative"),r=1);try{d&&c.forEach(e,function(a,b){a.offset=b/Q}),p=m.createRect({x:-r,y:-r,width:f+r,height:h+r}),p.setFill({type:"linear",x1:0,y1:0,x2:0,y2:h,colors:e}).setStroke(null),m.createRect({width:f,height:h}).setFill(new k([255,255,255,1-q.opacity])).setStroke(null),this._surfaceItems.push(m)}catch(ea){m.clear(),
m.destroy()}c.forEach(e,function(a,c){a.label&&(u="top:"+100*a.offset+"%;",a="",0===c&&(a+=" esriLegendColorRampTickFirst"),c===e.length-1&&(a+=" esriLegendColorRampTickLast"),b.create("div",{"class":"esriLegendColorRampTick"+a,innerHTML:"\x26nbsp;",style:u},l))});n=b.create("div",{"class":"esriLegendColorRampLabels",style:{height:h+this.gradientHeight+"px"}},a);d?c.forEach(e,function(a){b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:C.encode(a.label)||"\x26nbsp;"},n)}):(b.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},n),b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(h+this.gradientHeight-2*this.gradientHeight)+"px;"},n))},_showHeatRamp:function(a,e,c,d,h){var m,f=c.field;m=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=b.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||h)&&this._createHoverAction(m,a,e,h);(f=f&&this.getField(a,f,e))&&this._addSubHeader(d,this._getFieldAlias(f.name,
a,e));e=this._getHeatmapStops(c);e.length&&this._drawGradientRamp(d,e,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var d,f,h,g;b&&b[0]?(d=b.length-1,(a=b[0]&&null!=b[0].ratio)?(a=b[d])&&1!==a.ratio&&(b=b.slice(0),b.push({ratio:1,color:a.color}),d++):(f=b[0].value,h=b[d].value-f,b=c.map(b,function(a){return{color:a.color,ratio:(a.value-f)/h}}))):a&&a[0]&&(d=a.length-1,g=1/(a.length-1),b=c.map(a,function(a,b){return{color:a,ratio:b*g}}));b=c.map(b,function(a,b){var e="";0===b?e=
"Low":b===d&&(e="High");return{color:a.color,label:e,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,e,d,q){var h=d.legendOptions,m,g,k,l,n,r,p,t=this.dotDensitySwatchSize,u=Math.round(t/2);h&&(g=h.backgroundColor,k=h.outline,l=h.valueUnit,n=h.dotCoverage);n=(n||this.dotCoverage)/100;p=Math.round(t*t/Math.pow(d.dotSize,2)*n);q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},q);r=b.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,
a,e);this._addSubHeader(r,K.substitute({value:d.dotValue,unit:l||""},this.NLS_dotValue));c.forEach(d.fields,function(b){b=f.mixin({},b);b.numPoints=p;m=new X(d._generateImageSrc(t,t,[b],{x:0,y:0},{x:t,y:t},g),k||d.outline,t,t);b=this.getField(a,b.name,e)||b;this._buildRow_Renderer(a,m,null,C.encode(this._getFieldAlias(b.name,a,e)),null,r,{type:"path",path:"M "+-u+","+-u+" L "+u+","+-u+" L "+u+","+u+" L "+-u+","+u+" L "+-u+","+-u+" E"})},this)},_showSizeLegend:function(a,e,c,d,h,g,k,l,n){var m=d.legendOptions,
m=m&&m.customValues;h=this._getSizeSymbol(c,h);if((!d.valueUnit||"unknown"===d.valueUnit)&&h&&(m||null!=d.minSize&&null!=d.maxSize&&null!=d.minDataValue&&null!=d.maxDataValue||d.stops&&!(1>=d.stops.length))){n=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(n?"":" esriLegendSubFragment")},g);g=b.create("tbody",{},n);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(n,a,e,l);(k||d.valueExpression||d.legendOptions&&d.legendOptions.title)&&this._addSubHeader(g,
this._getRampTitle(d,a,e));k=d.field;var q;l=f.isFunction(k);k&&(q=l?null:a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(k):this.getField(a,k,e));e=q&&"esriFieldTypeDate"===q.type;var m=m||this._getDataValues(c,h,d,e),p,t=m.length-1;for(q=t;0<=q;q--)n=m[q],h=R.fromJson(h.toJson()),this._applySize(h,c,d,n),n=e?O.formatDate(n,O.timelineDateFormatOptions):B.format(n),p="",q===t?p=this._specialChars.gt+" ":0===q&&(p=k&&!l&&"cluster_count"===k.toLowerCase()&&1===m[q]?
"":this._specialChars.lt+" "),p="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+C.encode(p+n)+"\x3c/span\x3e",this._buildRow_Renderer(a,h,null,p,null,g)}},_getSizeSymbol:function(a,b){var e,c;if("esri.renderer.SimpleRenderer"===a.declaredClass)e=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)e=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)e=a.infos[0].symbol,c=1<a.infos.length;if(e=e&&
-1!==e.type.indexOf("fillsymbol")?null:e)if(e=R.fromJson(e.toJson()),b||c)-1!==e.type.indexOf("linesymbol")?e.setColor(new k(this.sizeRampDarkColor)):(e.setColor(new k(this.sizeRampLightColor)),e.setOutline&&(a=new Y,a.setColor(new k(this.sizeRampDarkColor)),a.setWidth(1.5),e.setOutline(a)));return e},_getDataValues:function(a,b,d,f,h,g){h=null==h?5:h;g=null==g?20:g;var e=a.getSizeRangeAtScale(d,this.map.getScale());h=this._interpolateSizeRange(e,h);var m=this._getDataRange(d),q=c.map(h,function(a){return this._getDataValueFromSize(a,
m,e)},this);if(!f){var k,q=B.round(q);for(f=1;f<q.length-1;f++)if(k=this._roundDataValue(a,b,d,q[f],q[f-1],g))q[f]=k[0],h[f]=k[1]}return q},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var e=a.minSize;a=(a.maxSize-e)/(b-1);var c,d=[];for(c=0;c<b;c++)d.push(e+a*c);return d},_getDataValueFromSize:function(a,b,c){var e=c.minSize;c=c.maxSize;var d=b.min;b=b.max;return a<=e?d:a>=c?
b:(a-e)/(c-e)*(b-d)+d},_roundDataValue:function(a,b,c,d,h,f){var e=this._getSize(b,a,c,d);h=this._getSize(b,a,c,h);var m,q=B.getDigits(d),g=q.integer,q=q.fractional,k,l,n,p,t,u,Q,w,v,x,y;0<d&&1>d&&(m=Math.pow(10,q),d*=m,g=B.getDigits(d).integer);for(--g;0<=g&&(k=Math.pow(10,g),q=Math.floor(d/k)*k,k*=Math.ceil(d/k),null!=m&&(q/=m,k/=m),l=(q+k)/2,l=B.round([q,l,k],{indexes:[1]})[1],n=this._getSize(b,a,c,q),p=this._getSize(b,a,c,k),t=this._getSize(b,a,c,l),u=B.getPctChange(e,n,h,null),Q=B.getPctChange(e,
p,h,null),w=B.getPctChange(e,t,h,null),v=u.prev<=f,x=Q.prev<=f,v&&x&&(u.prev<=Q.prev?(v=!0,x=!1):(x=!0,v=!1)),v?y=[q,n]:x?y=[k,p]:w.prev<=f&&(y=[l,t]),!y);g--);return y},_applySize:function(a,b,c,d){var e=a.type;b=this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=a.width;c=a.height;a.setHeight(b);a.setWidth(e/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,
b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,c,d,f,h,g,k,l){var e=!!l,m=b.create("tr",{},g),q;if(this.alignRight){if(g=b.create("td",{align:this._isRightToLeft?"left":"right"},m),c||e)q=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},m)}else{if(c||e)q=b.create("td",{width:35,align:"center"},m);g=b.create("td",{},m)}var n=m=30,p;if(c)if("simplemarkersymbol"==c.type)m=Math.min(Math.max(m,
c.size+12),125),n=Math.min(Math.max(n,c.size+12),125);else if("picturemarkersymbol"==c.type)m=Math.min(Math.max(m,c.width),125),n=Math.min(c.height||n,125);else if("textsymbol"==c.type){var t,u;c.text||(t=c.text,u=!0,c.setText(this.defaultText));m=Math.min(Math.max(m,c.getWidth()+12),125);n=Math.min(Math.max(n,c.getHeight()+12),125);u&&c.setText(t)}if(c||e)p=b.create("div",{style:"width:"+m+"px;height:"+n+"px;"},q);K.isDefined(f)&&"number"===typeof f&&(f=""+f);b.create("td",{innerHTML:f||"",align:this._align},
b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},g))));if(c||e)a=this._drawSymbol(p,c,d,m,n,h,a,k,l),this._surfaceItems.push(a)},_addSubHeader:function(a,c){a=b.create("tr",{},a);a=b.create("td",{align:this._align,colspan:2},a);b.create("td",{innerHTML:C.encode(c)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},a))))},_drawSymbol:function(a,b,c,d,h,g,l,n,p){var e=b&&R.fromJson(b.toJson()),m=l.opacity;b=!!p;if(e)if(c&&e.setColor(new k(c.toRgba())),
"simplelinesymbol"===e.type||"cartographiclinesymbol"===e.type||"textsymbol"===e.type){if(!e.color)return;c=e.color.toRgba();c[3]*=m;e.color.setColor(c)}else"simplemarkersymbol"===e.type||"simplefillsymbol"===e.type?(e.color&&(c=e.color.toRgba(),c[3]*=m,e.color.setColor(c)),e.outline&&e.outline.color&&(c=e.outline.color.toRgba(),c[3]*=m,e.outline.color.setColor(c))):"picturemarkersymbol"===e.type&&(a.style.opacity=m,a.style.filter="alpha(opacity\x3d("+100*m+"))");a=J.createSurface(a,d,h);9>t("ie")&&
(c=a.getEventSource(),x.set(c,"position","relative"),x.set(c.parentNode,"position","relative"));g=b?p.shapeDescriptor:this._getDrawingToolShape(e,g)||R.getShapeDescriptors(e);var q,m=(c=g.defaultShape)&&"text"===c.type;try{m&&!c.text&&(c.text=this.defaultText),q=a.createShape(n||c).setFill(g.fill).setStroke(g.stroke),m&&q.setFont(g.font)}catch(ea){a.clear();a.destroy();return}var u=q.getBoundingBox();n=u.width;g=u.height;var m=-(u.x+n/2),v=-(u.y+g/2);c=a.getDimensions();m={dx:m+c.width/2,dy:v+c.height/
2};if(e&&"simplemarkersymbol"===e.type&&"path"===e.style)d=l._getScaleMatrix(u,e.size),q.applyTransform(F.scaleAt(d.xx,d.yy,{x:c.width/2,y:c.height/2}));else if(n>d||g>h)l=n/d>g/h,d=((l?d:h)-5)/(l?n:g),f.mixin(m,{xx:d,yy:d});q.applyTransform(m);b&&q.applyTransform(F.rotategAt(p.rotation,n/2,g/2));return a},_getDrawingToolShape:function(a,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b=
{type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_drawRelationshipLegend:function(a,b){var c=b.focus,d=b.numClasses,e=ca[d],f=!!c,g=Math.sqrt(Math.pow(75,
2)+Math.pow(75,2)),k={};b.uvInfos.forEach(function(a){k[a.value]={label:a.label,fill:this._getSymbolColor(a.symbol)}},this);b=[];for(var l=0;l<d;l++){for(var n=[],p=0;p<d;p++)n.push(k[e[l][p]].fill);b.push(n)}e=this._getRelationshipCornerLabels(c,k);a=this._drawRampLayout(a,e,g,f);a=J.createSurface(a,g,g);f||(a.rawNode.style.margin="-15px -15px -18px -15px");b=Z.create2DColorRamp({surface:a,colors:b,numClasses:d,size:75});d=(g-75)/2;g=(g-75)/2;b.applyTransform(F.translate(d,g));f&&b.applyTransform(F.rotategAt(this._getRotationAngleForFocus(c),
37.5,37.5));b=a.createGroup();e={width:1,color:"#555555"};l=a.defNode;this._createArrowMarker(l,"start");this._createArrowMarker(l,"end");l=b.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(e);e=b.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(e);this._setLineArrow(l.rawNode,"left",c);this._setLineArrow(e.rawNode,"right",c);b.applyTransform(F.translate(d,g));f&&b.applyTransform(F.rotategAt(-45,37.5,37.5));this._surfaceItems.push(a)},_drawRampLayout:function(a,c,d,f){var e=b.create("div",{style:{padding:"10px"}},
a);a=d+"px";d+="px";f?(f=b.create("div",{style:{display:"flex"}},e),b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a,textAlign:"right"},innerHTML:c.left},f),e=b.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},f),b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:c.right},f),f=b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:c.top},
e),f=b.create("div",{style:{height:d,width:d}},e),e=b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:c.bottom},e)):(e=b.create("div",{style:{display:"table",color:"#555555"}},e),f=b.create("div",{style:{display:"table-row"}},e),d=b.create("div",{style:{display:"table-row"}},e),e=b.create("div",{style:{display:"table-row"}},e),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"bottom"},
innerHTML:c.left},f),b.create("div",{style:{display:"table-cell"}},f),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"bottom"},innerHTML:c.top},f),b.create("div",{style:{display:"table-cell"}},d),f=b.create("div",{style:{display:"table-cell"}},d),b.create("div",{style:{display:"table-cell"}},d),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"top"},
innerHTML:c.bottom},e),b.create("div",{style:{display:"table-cell"}},e),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"top"},innerHTML:c.right},e));return f},_getSymbolColor:function(a){if(a)return"simplelinesymbol"===a.type||"simplemarkersymbol"===a.type&&(a.style===U.STYLE_X||a.style===U.STYLE_CROSS)?(a=a.getStroke())&&a.color:a.getFill()},_getRotationAngleForFocus:function(a){var b=W[a];a&&null==b&&(b=W.HH);return b},_setLineArrow:function(a,
b,c){var d=this.id+"_arrowStart",e=this.id+"_arrowEnd";b="left"===b;switch(c){case "HL":a.setAttribute(b?"marker-start":"marker-end","url(#"+(b?e:d)+")");break;case "LL":a.setAttribute("marker-start","url(#"+e+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?d:e)+")");break;default:a.setAttribute("marker-end","url(#"+d+")")}},_createArrowMarker:function(a,b){var c="start"===b,d=this.id+(c?"_arrowStart":"_arrowEnd");b=c?"0,0 5,5 0,10":"5,0 0,5 5,10";var e=c?5:0,c=document.createElementNS("http://www.w3.org/2000/svg",
"marker");c.setAttribute("id",d);c.setAttribute("markerWidth","10");c.setAttribute("markerHeight","10");c.setAttribute("refX",e);c.setAttribute("refY","5");c.setAttribute("markerUnits","strokeWidth");c.setAttribute("orient","auto");d=document.createElementNS("http://www.w3.org/2000/svg","polyline");d.setAttribute("points",b);d.setAttribute("fill","none");d.setAttribute("stroke","#555555");d.setAttribute("stroke-width","1");c.appendChild(d);a.appendChild(c)},_getRelationshipCornerLabels:function(a,
b){var c=b.HH.label,d=b.LL.label,e=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:c,bottom:d,left:e,right:b};case "HL":return{top:e,bottom:b,left:d,right:c};case "LL":return{top:d,bottom:c,left:b,right:e};case "LH":return{top:b,bottom:e,left:c,right:d};default:return{top:c,bottom:d,left:e,right:b}}},_repaintItems:function(){c.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&
a.setFill(a.getFill())}catch(e){}a.children&&f.isArray(a.children)&&c.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,c,d,k){if(k=c._hoverLabel||c._hoverLabels&&c._hoverLabels[d.id]||k)k=C.encode(k),c.mouseMoveHandler=c.mouseMoveHandler||{},c.mouseMoveHandler[d.id]=g.connect(a,"onmousemove",f.hitch(this,function(a,c){this.mouseX=c.clientX;this.mouseY=c.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,x.set(u.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(f.hitch(this,
function(a,c,d){if(a==this.mouseX&&c==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,u.byId(this.id+"_hoverLabel")){var e=u.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";x.set(e,"top",c+"px");x.set(e,"left",a+15+"px");x.set(e,"display","")}else b.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:c+"px",left:a+15+"px"}},document.body)},c.clientX,c.clientY,a),500)},k)),c.mouseOutHandler=
c.mouseOutHandler||{},c.mouseOutHandler[d.id]=g.connect(a,"onmouseout",f.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,x.set(u.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;c.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)g.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)g.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=
[],d;c.forEach(a.dynamicLayerInfos||a.layerInfos,function(c){d={id:c.id};d.source=c.source&&c.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[c.id]&&(e=a.layerDefinitions[c.id]);e&&(d.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[c.id]&&(f=a.layerDrawingOptions[c.id]);f&&(d.drawingInfo=f.toJson());d.minScale=c.minScale||0;d.maxScale=c.maxScale||0;b.push(d)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&
0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(x.set(u.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(d,e){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,k;for(g=0;g<f.length;g++)if(f[g].id===d&&f[g].subLayerIds)for(k=0;k<
f[g].subLayerIds.length;k++){var m=f[g].subLayerIds[k];-1===c.indexOf(e,m)&&(e.push(m),b(m,e))}}a.layer.layerInfos&&c.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,k;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==f.minScale&&a.tileInfo&&
(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(k=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,k=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||k>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:
this["NLS_"+a.vectorFieldPixelFilter.inputUnit],K.isDefined(a)&&(b+=" ("+a+")"));return C.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(K.isDefined(b.parentLayerId)){a=a.layerInfos;b=b.parentLayerId;var e;for(e=a.length-1;0<=e;e--)if(a[e].id==b)if(0==c&&0<a[e].minScale?c=a[e].minScale:0<c&&0==a[e].minScale||0<c&&0<a[e].minScale&&(c=Math.min(c,a[e].minScale)),d=Math.max(d||0,a[e].maxScale||0),-1<a[e].parentLayerId)b=a[e].parentLayerId;else break}return{minScale:c,maxScale:d}},
_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===
a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(a,b,d){if(a.getField)return a.getField(b);if(d&&d.fields){var e;c.forEach(d.fields,function(a){a.name===b&&(e=a)});return e}return null}});f.mixin(M,{ALIGN_LEFT:0,ALIGN_RIGHT:1});t("extend-esri")&&f.setObject("dijit.Legend",
M,S);return M});