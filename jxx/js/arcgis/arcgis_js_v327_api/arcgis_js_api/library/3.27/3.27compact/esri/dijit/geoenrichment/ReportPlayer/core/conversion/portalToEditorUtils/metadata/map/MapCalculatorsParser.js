// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/conversion/portalToEditorUtils/metadata/map/MapCalculatorsParser",["esri/dijit/geoenrichment/utils/JsonXmlConverter","./MetadataToRendererParser","esri/dijit/geoenrichment/utils/ImageUtil"],function(e,l,m){return{parseMapCalculators:function(q,h,r){e.queryJson(q,"Maps").forEach(function(n){e.queryJson(n,"Map").forEach(function(f){var a=e.queryJson(f,/^(|Layer|LocatorResultsLayer|ComparisonResultsLayer)$/),c=a.filter(function(b){return!!b.attributes.PortalItemId}),
a=a.filter(function(b){return!!b.attributes.ServiceUrl||"LocatorResultsLayer"===b.name||"ComparisonResultsLayer"===b.name}),g;1<c.length&&(g=c.shift());var c=c.shift(),d=[];a.forEach(function(b){if(b.attributes.ServiceUrl)d.push({url:b.attributes.ServiceUrl});else if("LocatorResultsLayer"===b.name){var a=b.tags&&b.tags.filter(function(a){return"Renderer"===a.name})[0],c=h.metadata.locatorCalculatorsHash[b.attributes.CalculatorName];c.isValid&&d.push({isLocatorLayer:!0,layerName:b.attributes.LayerName,
calculatorName:b.attributes.CalculatorName,calculatorInfo:c,rendererJson:a&&l.parseRendererJson(a)})}else"ComparisonResultsLayer"===b.name&&((a=(a=b.tags&&b.tags.filter(function(a){return"Renderer"===a.name})[0])&&l.parseRendererJson(a))&&"esriTS"===a.uniqueValueInfos[0].symbol.type?d[d.length-1].labelRendererJson=a:d.push({isComparisonLayer:!0,calculatorName:b.attributes.CalculatorName,rendererJson:a,labelRendererJson:null}))});var p;if((a=e.queryJson(f,"SiteLayer")[0])&&(a=e.queryJson(a,"Symbol")[0])&&
"Image"===a.attributes.Type){var k=r.getImageData(a.attributes.Name);k&&(p={type:"esriPMS",contentType:m.getContentType(k),imageData:m.base64DataFromDataURL(k),width:Number(a.attributes.Width),height:Number(a.attributes.Height),angle:Number(a.attributes.Angle)||0,xoffset:Number(a.attributes.XOffset)||0,yoffset:Number(a.attributes.YOffset)||0})}g={fieldName:f.attributes.Name,defaultBasemapId:g&&g.attributes.PortalItemId,webMapId:c&&c.attributes.PortalItemId,additionalLayerInfos:d.length&&d,pinSymbolJson:p,
mapScale:Number(f.attributes.Scale)||null};h&&(h.metadata.mapImageInfosHash[n.attributes.Name+"."+f.attributes.Name]=g)})})}}});