// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/renderer/RasterUniqueValueRenderer",["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(t,w,u,r,v){return t([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(e){e&&e.colormap&&(this.colormap=e.colormap,this._function=new r(e),this._function.outputPixelType="U8",this._function.renderTexture=
!0)},bind:function(e){this.inherited(arguments);if(!this._function){var a=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!a)throw"uv renderer requires data source to have raster attribute table";var c=this.attributeField||this.field,f=this.infos||this.uniqueValueInfos;this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var h,g=a.fields.filter(function(b){return"value"===b.name.toLowerCase()})[0];g&&(h=g.name);c||((c=a.fields.filter(function(b){return-1<
["classname","category"].indexOf(b.name.toLowerCase())})[0])||(c=a.fields.filter(function(b){return"esriFieldTypeString"===b.type})[0]),this.alias=(this.field=c=c&&c.name||h)&&c.alias||h);var n=[],p,d,q,k,l,m;if(!f){f=[];q=a.fields.filter(function(b){return"alpha"===b.name.toLowerCase()})[0];k=a.fields.filter(function(b){return"red"===b.name.toLowerCase()})[0];l=a.fields.filter(function(b){return"green"===b.name.toLowerCase()})[0];m=a.fields.filter(function(b){return"blue"===b.name.toLowerCase()})[0];
for(g=0;g<a.features.length;g++)d=a.features[g].attributes,(p=f.some(function(b){b.value===d[c]}))||(q&&k&&l&&m?f.push({value:d[c],alias:d[c],color:[d[k.name],d[l.name],d[m.name],d[q.name]]}):k&&l&&m?f.push({value:d[c],alias:d[c],color:[d[k.name],d[l.name],d[m.name]]}):f.push({value:d[c],alias:d[c]}));if(!(k&&l&&m))for(p=v.createRandomColorRamp({size:f.length}),g=0;g<f.length;g++)f[g].color=p[g];this.uniqueValueInfos=f}if(f)f.forEach(function(b){n=n.concat(a.features.filter(function(a){return b.value==
a.attributes[c]}).map(function(a){return[a.attributes[h]].concat(b.color)}))}),this.defaultColor&&a.features.filter(function(b){n.some(function(a){return a[0]===b.attributes[h]})||n.push([b.attributes[h]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=new r({colormap:n});this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(e){e=this._clonePixelData(e);return e=this._function._colorize(e)},
drawGL:function(e){this._function._colorizeGL(e)},toJson:function(e){var a={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};e&&(a.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:a}}})});