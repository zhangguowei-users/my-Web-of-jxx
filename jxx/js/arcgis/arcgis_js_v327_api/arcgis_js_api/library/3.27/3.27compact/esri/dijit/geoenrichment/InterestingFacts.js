// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/InterestingFacts",["../../declare","./BaseWidget"],function(n,p){return n("esri.dijit.geoenrichment.InterestingFacts",[p],{_chartNode:null,_varNode:null,_table:null,_selectedFact:0,_lastSelectedTag:null,_updateTable:function(){var d=this.metadata.name,a=(this._selectedFact+1).toString(),g="FACT"+a+"VALUE";d3.select(this._varNode).text(this.getValueByName(0,"FACT"+a+"ALIAS"));var a=this.data.features,h=-Infinity,k=Infinity,e,l;a.forEach(function(b){var c=b.attributes[g];
c<k&&(k=c,e=b);c>h&&(h=c,l=b)});var m=d3.scale.linear().domain([0,1.4*h]).nice().range([0,100]),f=[{width:"50%",cl:"OneVarMultiComparison_TextColumn"},{width:"20%",cl:"OneVarMultiComparison_ValueColumn"},{cl:"OneVarMultiComparison_ChartColumn"}],a=d3.select(this._table).selectAll("tr").data(a);a.enter().append("tr").classed("OneVarMultiComparison_Row",!0).classed("AlternatingRow",function(b,c){return 1===c%2});a.exit().remove();a=a.selectAll("td").data(function(b){var c=b.attributes;return[{v:c[d],
f:b},{v:c[g],f:b},{v:c[g],f:b}]});a.enter().append("td");a.each(function(b,c){var a=d3.select(this);f[c].width&&(a=a.style("width",f[c].width));a=a.classed(f[c].cl,!0);2>c?a.text(b.v):(c=a.selectAll("div").data([1]),c.enter().append("div").style("height","9px"),c.transition().style("background-color",function(){return b.f===e?"#43D3FF":b.f===l?"#66F45B":"#b5b5b5"}).style("width",m(b.v)+"%"))})},updateUIExpanded:function(){var d=this;d.inherited(arguments);d._updateTable();var a=d._chartNode;a.innerHTML=
"";for(var g=a.clientWidth,h=a.clientHeight,k=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,l=[],m=0;30>m;m++){var f="FACT"+(m+1).toString();if(!d.getValueByName(0,f+"ALIAS"))break;var b=d.getValueByName(0,f+"DIFF"),c;0<b?c="#66F45B":(b=-b,c="#43D3FF");b>k&&(k=b);b<e&&(e=b);l.push({text:d.getValueByName(0,f+"TAG"),absDiff:b,color:c})}d3.layout.cloud().size([g,h]).words(l.map(function(a,b){a.size=Math.ceil(8+30*(a.absDiff-e)/(k-e));a.tagIndex=b;return a})).padding(5).rotate(function(){return 0}).font("Verdana").fontSize(function(a){return a.size}).on("end",
function(b){function c(a){d._selectedFact=a;e.classed("selected",function(b){return b.tagIndex===a})}var e=d3.select(a).selectAll("div").data(b).enter().append("div").style("font-size",function(a){return a.size+"px"}).style("color",function(a){return a.color}).style("left",function(a){return a.x+a.x0+g/2+"px"}).style("top",function(a){return a.y+a.y0+h/2+"px"}).style("margin",function(a){return a.padding+"px"}).text(function(a){return a.text}).on("click",function(a){c(a.tagIndex);d._updateTable()});
c(0)}).start()},createUIExpanded:function(d){this.inherited(arguments);this._chartNode=d.addContent("div",{"class":"InterestingFacts_Chart"});this._varNode=d.addFooter("div",{"class":"OneVarMultiComparison_TextColumnHeader"});this._table=d.addFooter("table",{"class":"OneVarMultiComparison_Table"})}})});