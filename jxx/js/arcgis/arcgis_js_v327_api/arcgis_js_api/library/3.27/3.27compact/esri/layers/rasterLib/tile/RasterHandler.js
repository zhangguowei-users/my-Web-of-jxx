// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/tile/RasterHandler","require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(l,p,m,h,q,g,k,c,n,r,t,u){return function(){function b(a){this.customModules=a&&a.customModules}b.prototype.destroy=function(){this.stop();
this.customModules=this.rasterLayer=null};b.prototype.start=function(){this.stop();var a=new h,e=0,d=this.customModules?this.customModules.length+1:1,f=n.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",l,m),b=k.open(f,{client:this}).then(function(b){this._connection=b;e++;e===d&&(this._connected=!0,a.resolve())}.bind(this));this._openDL=[b];this.customModules&&this.customModules.forEach(function(f){b=k.open(f,{client:this}).then(function(b){e++;e===d&&(this._connected=!0,a.resolve())});this._openDL.push(b);
console.log(f)}.bind(this));return this._connectionPromise=a.promise};b.prototype.stop=function(){this._openDL?this._openDL.forEach(function(a){a.isFulfilled()||a.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=null)};b.prototype.decode=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return c.reject(Error("no connection"));var b={id:null};return this._connection.invoke("decode",
a,[],b).then(function(a){a.targetWorker=b;return a})};b.prototype.process=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return c.reject(Error("no connection"));var b={id:null};a.layerId=this.rasterLayer.layerId;var d=new h;this._connection.invoke("process",a,[],b).then(function(a){a.targetWorker=b;a.src?Object.keys(a.src).forEach(function(b){a.src[b].pixelBlock=new g(a.src[b].pixelBlock)}):a.src=null;a.pixelBlock&&(a.pixelBlock=new g(a.pixelBlock));d.resolve(a)});return d.promise};
b.prototype.render=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return c.reject(Error("no connection"));var b={id:null};a.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",a,[],b).then(function(a){a.targetWorker=b;a.pixelBlock=a.pixelBlock?new g(a.pixelBlock):null;return a})};b.prototype.setLayer=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return c.reject(Error("no connection"));this.rasterLayer=a;return this._connection.broadcast("setLayer",
a,[],{id:null})};b.prototype.setRasterFunction=function(a){return this._connectionPromise.isFulfilled()&&this._connection?this._connection.broadcast("setRasterFunction",a,[],{id:null}):c.reject(Error("no connection"))};b.prototype.setRasterRenderer=function(a){return this._connectionPromise.isFulfilled()&&this._connection?this._connection.broadcast("setRasterRenderer",a,[],{id:null}):c.reject(Error("no connection"))};return b}()});