// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/tasks/RunReportTask","dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ./parsers/DataXMLParser ./EnrichAreasTask ../AnalysisAreaJsonUtil esri/dijit/geoenrichment/ReportPlayer/config".split(" "),function(m,c,g,f,n,p,q,h){var k={_cache:{},_buildKey:function(a){return[a.countryID,a.hierarchy,JSON.stringify(q.areasToJson(a.analysisAreas,{excludeInfoTemplate:!0})),a.report.reportID,a.report.portalUrl,a.report.modified].join("_")},
getCopy:function(a){a=this._buildKey(a);return(a=this._cache[a])&&c.clone(a)},copyAndPut:function(a,d){a=this._buildKey(a);this._cache[a]=d&&c.clone(d)}},r={execute:function(a){function d(){return(new p).createReport(a).then(function(b){var d=b&&b.taskID;b=b&&b.result;try{var e;b&&"object"===typeof b&&(e=b.error);if(!e&&"string"===typeof b&&-1!==b.indexOf("{"))try{var c=JSON.parse(b);e=c&&c.error}catch(l){}if(e)if(h.runReportTask.ignoreErrors)b=[];else return(new g).reject(e);var f={taskID:d,areaData:n.parse(b),
error:e};a.cacheResult&&!e&&k.copyAndPut(a,f);return f}catch(l){return(new g).reject(l)}})}var c=a.cacheResult&&k.getCopy(a);return c?f(c):f(d(),function(a){return!a||a.error?h.runReportTask.secondAttempt?d():a:a},function(a){return h.runReportTask.secondAttempt?d():(new g).reject(a)})}};return m(null,{execute:function(a){console.log("Creating a new report...");return r.execute(a)}})});