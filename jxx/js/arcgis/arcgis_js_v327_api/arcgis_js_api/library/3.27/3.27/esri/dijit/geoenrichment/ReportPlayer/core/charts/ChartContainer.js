// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/geoenrichment/ReportPlayer/core/templates/ChartContainer.html":'\x3cdiv class\x3d"esriGEReportPlayer_chartContainer"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"chartLabel" class\x3d"chartContainer_chartLabel TrimWithEllipses"\x3e\x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"noDataPlaceHolder" class\x3d"esriGENoDataPlaceHolder"\x3e\r\n        \x3cdiv class\x3d"esriGENoDataPlaceHolderLabel"\x3e${nls.noChartData}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"chartNormalViewDiv"\x3e\r\n        \x3cdiv class\x3d"chartContainer_chartContainerWithAxis" data-dojo-attach-point\x3d"chartContainerWithAxis"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"chartContainerDiv"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"tableContainerDiv"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"legendContainerDiv" class\x3d"chartContainer_legendContainer"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"comparisonSelectBlock" class\x3d"chartContainer_comparisonSelectBlock"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"comparisonLabel" class\x3d"chartContainer_comparisonLabel"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"comparisonSelectDiv" class\x3d"chartContainer_comparisonSelectDiv"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"errorDiv" class\x3d"esriGEReportPlayerErrorMessage"\x3e${nls.chartLoadError}\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"missingVariablesDiv" class\x3d"chartContainer_missingVariablesMessage"\x3e${nls.chartContainerMissingVariables}\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/ChartContainer","require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-style dojo/when dijit/_WidgetBase dijit/_TemplatedMixin ./_ChartLegendSupport ./_ChartEventSupport ./_ChartComparisonSupport ./utils/ChartTypes ./utils/ChartSorting ./utils/ChartJsonUtil ./utils/builder/ChartPlots ./utils/ChartFilterUtil esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/InvokeUtil esri/dijit/geoenrichment/utils/WaitingUtil dojo/text!../templates/ChartContainer.html dojo/i18n!esri/nls/jsapi ../../_devConfig".split(" "),
function(F,r,G,t,l,u,e,d,H,I,J,K,L,g,M,v,h,N,c,O,P,Q,m,w){function R(){if(a)return a.promise;var a=new t;F("dojox/charting/Chart dojox/charting/action2d/Magnify ./utils/action2d/Highlight ./utils/builder/ChartBuilder ./utils/ChartCalculator ./utils/ChartStyleUtil ./tooltips/ChartTooltip ./iconRendering/IconRenderer ./textRendering/TextRenderer ./tableViewRendering/TableViewRenderer".split(" "),function(b,k,f,c,d,e,g,h,l,m){x=b;y=k;z=f;n=c;p=d;A=e;B=g;q=h;C=l;D=m;E=r(x,{_renderPlotBackground:function(a,
b,k,f){this.theme.plotarea.backgroundImageData?this.surface.createImage({src:this.theme.plotarea.backgroundImageData,x:b.l-1,y:b.t-1,width:k+2,height:f+2}):this.inherited(arguments)}});a.resolve()});return a.promise}m=m.geoenrichment.dijit.ReportPlayer.ChartContainer;var E,x,y,z,n,p,A,B,q,C,D;return r([H,I,J,K,L],{templateString:Q,nls:m,viewModel:null,theme:null,parentWidget:null,currentFeatureIndex:null,immediateRender:!1,chartTheme:null,enableAutoLabelsTitleForMultiFeatureChart:!0,chart:null,_currentSeries:null,
_iconRenderer:null,_textRenderer:null,_tableViewRenderer:null,postCreate:function(){this.inherited(arguments);this._showError(!1);c.hide(this.missingVariablesDiv);this.viewModel.isGraphicStyle&&l.add(this.domNode,"graphicReportChart");l.add(this.domNode,this.viewModel.isLightDocumentTheme(this.theme)?"light":"dark");this._showEmptyView(!1)},_currentSeriesItems:null,_currentSeriesItemsUnfiltered:null,_originalSeriesItems:null,_currentVisualProperties:null,_currentChartType:null,_currentComparisonInfo:null,
_isMultiFeatureChart:null,_initPromise:null,updateChart:function(a){this._destroyChart();if(a)return v.cleanUpJson(a),this._checkForMissingVariables(a),this._currentChartType=a.type,this._currentSeriesItems=(this._isMultiFeatureChart=a.isMultiFeatureChart)?v.getSeriesItemsForMultiFeatureChart(a.type,a.seriesItems,this.viewModel.dynamicReportInfo&&this.viewModel.dynamicReportInfo.fieldData.areaData):a.seriesItems,this._originalSeriesItems=a.seriesItems&&a.seriesItems.slice(),this._currentVisualProperties=
a.visualProperties,this._currentComparisonInfo=a.comparisonInfo,e.set(this.domNode,{width:this._currentVisualProperties.width+"px",height:this._currentVisualProperties.height+"px"}),this.domNode.style.backgroundColor=this._currentVisualProperties.panelBackgroundColor||"",c.hide(this.chartLabel),this._initPromise=R().then(function(){this.domNode&&(this._initChartComparisonSelect(),this._updateLabels(),this._createChart(),this._addPlotEventListeners(),this._createLegend(),this._updateSeries())}.bind(this)),
P.showProgressPromise(this.domNode,this._initPromise)},_checkForMissingVariables:function(a){var b=a.seriesItems.some(function(a){return a.points.some(function(a){return a.fieldInfo&&a.fieldInfo.isMissing})});c[b?"show":"hide"](this.missingVariablesDiv);b&&(this.missingVariablesDiv.style.top=(a.visualProperties.height-this.missingVariablesDiv.clientHeight)/2+"px")},isMultiFeatureChart:function(){return this._isMultiFeatureChart},getLegendNode:function(){return this.legendContainerDiv},_updateLabels:function(){this.chartLabel.innerHTML=
this._currentVisualProperties.title.text;c[this.chartLabel.innerHTML?"show":"hide"](this.chartLabel);this.chartLabel.style.textAlign=this._currentVisualProperties.title.align;this.chartLabel.style.marginTop=(this._currentVisualProperties.title.verticalShift||0)+"px";var a=G.mixin({},this.viewModel.getChartDefaultStyles(this.theme).titleStyle,this._currentVisualProperties.title.style);delete a.backgroundColor;e.set(this.chartLabel,A.getStyleObjWithUnits(a))},_createChart:function(){var a=u.create("div",
{"class":"chartContainerDiv_innerChartNode"},this.chartContainerDiv),b=new E(a);this.chart=b;b.setTheme(this.chartTheme);n.getChartBuilder(this._currentChartType).configureChart({chart:b,seriesItems:this._currentSeriesItems,visualProperties:this._currentVisualProperties,chartType:this._currentChartType,comparisonInfo:this._currentComparisonInfo,themeSettings:this.viewModel.getChartDefaultStyles(this.theme),viewModel:this.viewModel,currentFeatureIndex:this.currentFeatureIndex});this.viewModel.dynamicReportInfo&&
(g.isPieLike(this._currentChartType)&&new y(b,h.PRIMARY,{scale:1.03}),h.getWorkingPlots(b).forEach(function(a,f){f=0===f?this._currentChartType:this._getComparisonChartType();new z(b,a,{stroke:f===g.RING})},this));h.getWorkingPlots(b).forEach(function(a,f){f=0===f?this._currentChartType:this._getComparisonChartType();a=new B(b,a,{duration:50});a.showStatistics=!!this.viewModel.dynamicReportInfo||w.charts.showStatisticsInTooltips;a.setChartType(f)},this)},_destroyChart:function(){this._levelLineBuilder&&
this._levelLineBuilder.hideLevelLine();this.chartContainerDiv&&u.empty(this.chartContainerDiv);this.chart&&this.chart.destroy();this.chart=null;this._destroyLegend()},_updateSeries:function(){var a=this;this._removeSeries();if(this._currentSeriesItems){this._currentSeries=n.getChartBuilder(this._currentChartType).calcSeries({chart:this.chart,chartType:this._currentChartType,isMultiFeatureChart:this._isMultiFeatureChart,viewModel:this.viewModel,themeSettings:this.viewModel.getChartDefaultStyles(this.theme),
seriesItems:this._currentSeriesItems,visualProperties:this._currentVisualProperties,currentFeatureIndex:this.currentFeatureIndex,excludedSeriesHash:this._excludedSeriesHash,sorting:this._sorting||this._currentVisualProperties.sorting,comparisonInfo:this._currentComparisonInfo,comparisonFeatureIds:this._getComparisonFeatureIds(),ge:this._getGeoenrichment()});var b=n.checkSeriesAreValid(this._currentSeries);this._showError(!b);var c;b&&(this._currentSeries.forEach(function(b){a._excludedSeriesHash[b.name]||
a.chart.addSeries(b.name,b.data,b.params)}),c=this.resize());return d(c,function(){a.onContentUpdated()})}this.resize()},_removeSeries:function(){var a=this;this._currentSeries=this._currentSeries||[];this._currentSeries.forEach(function(b){a.chart.removeSeries(b.name)});this._currentSeries.length=0},_chartWidth:0,_chartHeight:0,_resizedFlag:!1,_resizeDfd:null,_pendingResizeObj:!1,resize:function(a,b,k){if(this._currentVisualProperties)return void 0!==a&&e.set(this.domNode,{width:a+"px",height:b+
"px"}),d(this._initPromise,function(){if(c.isNodeInLayout(this.domNode))return void 0!==a&&p.resizeVisualProperties(this._currentVisualProperties,a,b),this._resizedFlag||(this.domNode.style.opacity="0"),this._resizeDfd=this._resizeDfd||new t,k||this.immediateRender?this._doResizeChart():O.invoke(this,"_doResizeChart",50);this._pendingResizeObj={width:a,height:b,immediate:k}}.bind(this))},_doResizeChart:function(){var a=this;if(this.chart){this._resizedFlag||(this.domNode.style.opacity="1");this._resizedFlag=
!0;this._updateLegend();var b=p.calcChartDimentions(this,{visualProps:this._currentVisualProperties,comparisonInfo:this._currentComparisonInfo,chartType:this._currentChartType,maxIconSize:q.AXIS_ICON_MAX_SIZE}),c=b.w,b=b.h;if(this._isMultiFeatureChart&&this.enableAutoLabelsTitleForMultiFeatureChart&&this._currentChartType===g.COLUMN){var d=p.calcAxisLabelsAutoTitle(c,this._currentSeries,this._currentVisualProperties,this.viewModel.getChartDefaultStyles(this.theme));this.chart.getAxis("x").opt.rotation=
d?-d:-this._currentVisualProperties.xAxis.labelsAngle}this._chartWidth=c;this._chartHeight=b;this._adjustErrorMessage();if(this._isTableView)this._refreshTableView(),this._renderChartPendingFlag=!0;else{try{this.chart&&(this.chart.isPreRenderMode=g.isColumnBarLike(this._currentChartType),this.chart.resize(this._chartWidth,this._chartHeight),this.chart.dirty&&this.chart.render(),g.isColumnBarLike(this._currentChartType)&&n.getChartBuilder(this._currentChartType).updateBarSize({chart:this.chart,chartType:this._currentChartType,
isMultiFeatureChart:this._isMultiFeatureChart,currentFeatureIndex:this.currentFeatureIndex,viewModel:this.viewModel,seriesItems:this._currentSeriesItems,visualProperties:this._currentVisualProperties,chartSize:this.chart.plotArea[g.isColumnLike(this._currentChartType)?"width":"height"],comparisonInfo:this._currentComparisonInfo,comparisonFeatureIds:this._getComparisonFeatureIds()}),this.chart.isPreRenderMode=!1,this.chart.dirty&&this.chart.render())}catch(S){console.log(S)}(function(){setTimeout(function(){a._updateLegend();
a._updateIcons();a._updateTexts()});a.onRendered();a._resizeDfd&&a._resizeDfd.resolve();a._resizeDfd=null})()}}},notifyShown:function(){var a=this;return d(this._initPromise,function(){c.isNodeInLayout(a.domNode)&&d(a._pendingResizeObj&&a.resize(a._pendingResizeObj.width,a._pendingResizeObj.height,a._pendingResizeObj.immediate),function(){a._pendingResizeObj=null;a.viewModel.animationAllowed&&h.getWorkingPlots(a.chart).forEach(function(b,c){a.chart.getPlot(b).renderAnimation&&a.chart.getPlot(b).renderAnimation()})})})},
onRendered:function(){},_getIconRendererClass:function(){return q},_updateIcons:function(){this._iconRenderer||(this._iconRenderer=(new this._getIconRendererClass)(),this.own(this._iconRenderer),this._iconRenderer.setViewMode(this._viewMode));this._iconRenderer.renderIcons({viewModel:this.viewModel,theme:this.theme,parentWidget:this,chartType:this._currentChartType,iconNode:this.chartContainerWithAxis,chartW:this._chartWidth,chartH:this._chartHeight,visualProperties:this._currentVisualProperties,
comparisonInfo:this._currentComparisonInfo,chart:this.chart})},_getTextRendererClass:function(){return C},_updateTexts:function(){this._textRenderer||(this._textRenderer=(new this._getTextRendererClass)(),this._textRenderer.currentFeatureIndex=this.currentFeatureIndex,this.own(this._textRenderer),this._textRenderer.setViewMode(this._viewMode));this._textRenderer.renderTexts({viewModel:this.viewModel,theme:this.theme,parentWidget:this,textNode:this.chartContainerWithAxis,chartW:this._chartWidth,chartH:this._chartHeight,
visualProperties:this._currentVisualProperties,chart:this.chart})},_viewMode:null,setViewMode:function(a){if(this._viewMode!==a)return this._viewMode=a,d(this._initPromise,function(){this._iconRenderer&&this._iconRenderer.setViewMode(a);this._textRenderer&&this._textRenderer.setViewMode(a);this._tableViewRenderer&&this._tableViewRenderer.setViewMode(a)}.bind(this))},_showError:function(a){w.emulateErrors.contentErrors&&(a=!0);c[a?"show":"hide"](this.errorDiv);c[a?"hide":"show"](this.chartNormalViewDiv)},
_adjustErrorMessage:function(){this.errorDiv.style.paddingTop=e.get(this.domNode,"height")/2-20+"px"},_sorting:null,getSorting:function(){return this._sorting},sortChart:function(a){this._sorting=a&&a!==M.NONE?a:null;return d(this._initPromise,function(){this._updateSeries()}.bind(this))},_filterStats:null,_numShownAreas:null,getFilterRanges:function(){return this._isMultiFeatureChart&&this._getGeoenrichment()?d(this._initPromise,function(){this._filterStats=this._getGeoenrichment().collectFilterRangesStats();
return this._filterStats.filterRanges}.bind(this)):this._filterStats=null},setFilterRanges:function(a){return d(this._initPromise,function(){this._currentSeriesItemsUnfiltered&&(this._currentSeriesItems=this._currentSeriesItemsUnfiltered,this._currentSeriesItemsUnfiltered=null);this._currentSeriesItemsUnfiltered=this._currentSeriesItems;var b=N.filterSeriesItems(this._currentChartType,this._currentSeriesItems,a,this.viewModel);this._currentSeriesItems=b.seriesItems;this._numShownAreas=b.numShownAreas;
this._setFilterRangesForComparison(a)?this._numShownAreas+=this._getGeoenrichment().getAllGeographyAttributes().length:this._updateSeries();this._showEmptyView(!this._numShownAreas)}.bind(this))},_getCalculatorName:function(){var a=this._originalSeriesItems[0].points[0].fieldInfo;return a&&a.templateName.substr(0,a.templateName.indexOf("."))},getNumAreasTotal:function(){return this._filterStats&&this._filterStats.numAreasTotal||0},getNumAreasShown:function(){return"number"===typeof this._numShownAreas?
this._numShownAreas:this.getNumAreasTotal()},_showEmptyView:function(a){c[a?"hide":"show"](this.chartNormalViewDiv);c[a?"show":"hide"](this.noDataPlaceHolder);a&&this._syncEmptyViewPlaceholder()},_syncEmptyViewPlaceholder:function(){this.noDataPlaceHolder&&e.set(this.noDataPlaceHolder,"paddingTop",(e.get(this.domNode,"height")-e.get(this.noDataPlaceHolder,"height"))/2+"px")},_isTableView:!1,_renderChartPendingFlag:!1,chartToTable:function(){if(!this._isTableView)return d(this._initPromise,function(){this._setIsTableView(!0);
c.hide([this.chartContainerDiv,this.legendContainerDiv]);for(var a=0;a<this.chartContainerWithAxis.children.length;a++){var b=this.chartContainerWithAxis.children[a];b!==this.tableContainerDiv&&c.hide(b)}this._tableViewRenderer||(this._tableViewRenderer=new D,this.own(this._tableViewRenderer),this._tableViewRenderer.setViewMode(this._viewMode));this._refreshTableView(!0)}.bind(this))},_setIsTableView:function(a){this._isTableView=a;l[this._isTableView?"add":"remove"](this.domNode,"isChartDataInTableView");
this._updateComparisonLabel()},_refreshTableView:function(a){var b=e.get(this.domNode,"height")-e.get(this.chartLabel,"height");this._currentComparisonInfo&&(b-=40);this._tableViewRenderer.renderTableForChart({chartType:this._currentChartType,isMultiFeatureChart:this._isMultiFeatureChart,viewModel:this.viewModel,theme:this.theme,parentWidget:this,tableNode:this.tableContainerDiv,width:e.get(this.domNode,"width"),height:b,chartSeries:this._currentSeries,visualProperties:this._currentVisualProperties,
hasComparison:!!this._currentComparisonInfo,chart:this.chart,showAnimation:a})},tableToChart:function(){if(this._isTableView)return d(this._initPromise,function(){this._setIsTableView(!1);c.show([this.chartContainerDiv,this.legendContainerDiv]);for(var a=0;a<this.chartContainerWithAxis.children.length;a++)c.show(this.chartContainerWithAxis.children[a]);this._tableViewRenderer&&this._tableViewRenderer.destroyTable();this._renderChartPendingFlag?(this._renderChartPendingFlag=!1,d(this.resize(),this.notifyShown.bind(this))):
this.notifyShown()}.bind(this))},getVisualState:function(){return{sorting:this.getSorting(),isTableView:this._isTableView,tableViewRenderer:this._tableViewRenderer&&this._tableViewRenderer.getVisualState()}},setVisualState:function(a){if(a)return d(this._resizeDfd&&this._resizeDfd.promise,function(){a.sorting&&this.sortChart(a.sorting);a.isTableView&&(this.chartToTable(),this._tableViewRenderer&&this._tableViewRenderer.setVisualState(a.tableViewRenderer))}.bind(this))},getWidth:function(){return this._currentVisualProperties.width},
getHeight:function(){return this._currentVisualProperties.height},onContentUpdated:function(){},destroy:function(){this._destroyChart();this.inherited(arguments)}})});