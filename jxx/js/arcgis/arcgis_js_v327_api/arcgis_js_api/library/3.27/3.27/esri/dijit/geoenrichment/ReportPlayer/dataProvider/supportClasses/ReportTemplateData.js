// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/ReportTemplateData","dojo/_base/declare dojo/_base/lang dojo/request/xhr dojo/promise/all esri/kernel esri/request esri/urlUtils esri/dijit/geoenrichment/utils/DataUtil esri/dijit/geoenrichment/utils/PortalUtil".split(" "),function(g,h,k,l,m,n,p,e,q){return g(null,{id:null,_portal:null,_baseUrl:null,constructor:function(a,b){this.id=a.id;this._portal=b;this._baseUrl=this._portal.url+"/sharing/rest"},getFiles:function(){var a=
this;return this._getResources().then(function(b){var f=[];b.map(function(b){var c=b.resource;if("thumbnail.png"!==c){b=a._baseUrl+"/"+a._contentItemPath(a.id+"/resources/"+c);var d=p.getProxyRule(b);f.push(k(d&&d.proxyUrl?d.proxyUrl+"?"+b:b,{method:"POST",handleAs:"arraybuffer",data:"token\x3d"+a._getToken(),headers:{"X-Requested-With":null,"Content-Type":"application/x-www-form-urlencoded; charset\x3dutf-8"}}).then(function(a){var b=!/\.xml$|\.txt$|\.json$/i.test(c);return{name:c,data:b?e.base64FromByteSource(a):
decodeURIComponent(escape(e.binaryStringFromByteSource(a)))}}))}});return l(f)})},_contentItemPath:function(a){return"content/items/"+a},_getToken:function(){return m.id.credentials[0].token},_getResources:function(){var a=this;return q.query(function(b){return n({url:a._baseUrl+"/"+a._contentItemPath(a.id+"/resources"),content:h.mixin({f:"json",token:a._getToken()},b),handleAs:"json"},{usePost:!0})},null,"resources").then(function(a){return a.resources})},getPortalUrl:function(a){return a?/[^:]+:\/\/(.+)$/i.exec(this._portal.url)[1]:
this._portal.url}})});