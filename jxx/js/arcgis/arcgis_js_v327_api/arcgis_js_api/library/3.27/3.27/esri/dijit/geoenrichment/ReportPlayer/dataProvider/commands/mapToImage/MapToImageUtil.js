// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/mapToImage/MapToImageUtil","dojo/Deferred dojo/when dojo/dom-construct dojo/promise/all ./MapToURLUtil ./_MapReplacer".split(" "),function(p,f,q,m,d,n){var c={};c.enableCaching=d.enableCaching;c.clearCaching=d.clearCaching;c.replaceMapWithImage=function(b,a){a=a||{};var g=[],c={errors:[],undo:function(){g.map(function(a){a()})}},k=b.collectMaps({allAreas:!0}),l=[];return m(k.map(function(e){return f(d.mapToURL(e.map,e.legend,e.node,
a),function(c){var b=n.replaceMapWithImage(e.node);g.push(b.undo);l.push(e);var h=new p;b.mapImage.onload=h.resolve;b.mapImage.onerror=function(a){console.log(a);q.destroy(b.mapImage);h.resolve()};f(d.urlToSrc(c,a),function(a){b.mapImage.src=a});return h.promise})})).always(function(){l.length!==k.length&&(k.forEach(function(a){-1===l.indexOf(a)&&(a=n.replaceMapWithImage(a.node),g.push(a.undo))}),c.errors.push(Error("Some maps can't be exported")));return c})};c.mapInfoToDataUrl=function(b,a){a=a||
{};return f(d.mapToURL(b.map,b.legend,b.node,a),function(b){return d.urlToSrc(b,a)})};c.collectMapsAsImages=function(b,a){a=a||{};b=b.collectMaps({allAreas:!0});return m(b.map(function(b){return f(d.mapToURL(b.map,b.legend,b.node,a),function(b){return d.urlToSrc(b,a)}).otherwise(function(){return null}).then(function(a){return{url:a,itemId:b.itemId,areaIndex:b.areaIndex,position:b.position}})}))};return c});