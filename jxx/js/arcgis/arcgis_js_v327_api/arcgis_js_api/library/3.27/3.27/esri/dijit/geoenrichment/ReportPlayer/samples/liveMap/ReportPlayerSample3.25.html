<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Report Player Sample JS API 3.24</title>

    <link rel="stylesheet" href="https://js.arcgis.com/3.25/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.25/esri/css/esri.css">

    <script src="https://js.arcgis.com/3.25/"></script>

    <script>
    </script>

    <style>
        html,
        body {
            padding: 0;
            margin: 0;
            height: 100%;
            overflow: hidden;
            font-size: 13px;
            font-family: "Avenir Next";
        }
    </style>

    <script>

        require([
            "dojo/when",

            "esri/IdentityManager",
            "esri/arcgis/OAuthInfo",
            "esri/urlUtils",

            "esri/dijit/geoenrichment/ReportPlayer/ReportPlayer",
            "esri/dijit/geoenrichment/ReportPlayer/PlayerResizeModes",
            "esri/dijit/geoenrichment/ReportPlayer/PlayerThemes",
            "esri/dijit/geoenrichment/ReportPlayer/DataProviderGE",
            "esri/dijit/geoenrichment/ReportPlayer/PlayerCommands",

            "dojo/domReady!"
        ],
            function (
                when,

                esriId,
                ArcGISOAuthInfo,
                urlUtils,

                ReportPlayer,
                PlayerResizeModes,
                PlayerThemes,
                DataProviderGE,
                PlayerCommands
            ) {

                // All requests to geoenrich.arcgis.com, arcgis.com will proxy to the proxyUrl defined in this object.
                urlUtils.addProxyRule({
                    urlPrefix: "geoenrich.arcgis.com",
                    proxyUrl: "/Proxy/proxy.ashx"
                });

                urlUtils.addProxyRule({
                    urlPrefix: "www.arcgis.com",
                    proxyUrl: "/Proxy/proxy.ashx"
                });

                var PORTAL_URL = "https://www.arcgis.com";

                var analysisJson = [{
                    "name": "Area name",
                    "shortName": "Area name (short)",
                    "description": "Area description",
                    "address": "Area address",
                    "latitude": "Area Lat.",
                    "longitude": "Area Long.",
                    "feature": {
                        "geometry": {
                            "rings": [[[-8526812.632035743,4762918.421080843],[-8526816.077771675,4762813.164736723],[-8526826.400224296,4762708.359116427],[-8526843.555191284,4762604.453013712],[-8526867.469212433,4762501.891370461],[-8526898.039884238,4762401.113371379],[-8526935.136298383,4762302.550563325],[-8526978.599602329,4762206.625007379],[-8527028.243679538,4762113.7474714955],[-8527083.85594645,4762024.315671543],[-8527145.198262798,4761938.712568219],[-8527212.007951368,4761857.304727154],[-8527283.998922816,4761780.44074922],[-8527360.862900749,4761708.449777773],[-8527442.270741815,4761641.640089203],[-8527527.873845138,4761580.297772855],[-8527617.30564509,4761524.685505943],[-8527710.183180973,4761475.041428735],[-8527806.108736921,4761431.578124787],[-8527904.671544973,4761394.481710642],[-8528005.449544057,4761363.911038839],[-8528108.011187308,4761339.997017689],[-8528211.91729002,4761322.842050701],[-8528316.722910317,4761312.519598079],[-8528421.979254438,4761309.073862148],[-8528527.235598559,4761312.519598079],[-8528632.041218854,4761322.842050701],[-8528735.947321568,4761339.997017689],[-8528838.508964818,4761363.911038839],[-8528939.286963902,4761394.481710642],[-8529037.849771954,4761431.578124787],[-8529133.775327902,4761475.041428735],[-8529226.652863786,4761524.685505943],[-8529316.084663738,4761580.297772855],[-8529401.68776706,4761641.640089203],[-8529483.095608126,4761708.449777773],[-8529559.95958606,4761780.44074922],[-8529631.950557508,4761857.304727154],[-8529698.760246078,4761938.712568219],[-8529760.102562426,4762024.315671543],[-8529815.714829337,4762113.7474714955],[-8529865.358906547,4762206.625007379],[-8529908.822210493,4762302.550563325],[-8529945.918624638,4762401.113371379],[-8529976.489296442,4762501.891370461],[-8530000.403317591,4762604.453013712],[-8530017.558284579,4762708.359116427],[-8530027.8807372,4762813.164736723],[-8530031.326473132,4762918.421080843],[-8530027.8807372,4763023.677424963],[-8530017.558284579,4763128.483045259],[-8530000.403317591,4763232.389147974],[-8529976.489296442,4763334.950791224],[-8529945.918624638,4763435.7287903065],[-8529908.822210493,4763534.29159836],[-8529865.358906547,4763630.217154306],[-8529815.714829337,4763723.09469019],[-8529760.102562426,4763812.526490143],[-8529698.760246078,4763898.129593466],[-8529631.950557508,4763979.537434531],[-8529559.95958606,4764056.401412466],[-8529483.095608126,4764128.392383913],[-8529401.68776706,4764195.202072483],[-8529316.084663738,4764256.544388831],[-8529226.652863786,4764312.156655742],[-8529133.775327902,4764361.800732951],[-8529037.849771954,4764405.2640368985],[-8528939.286963902,4764442.360451044],[-8528838.508964818,4764472.931122846],[-8528735.947321568,4764496.845143996],[-8528632.041218854,4764514.000110984],[-8528527.235598559,4764524.322563606],[-8528421.979254438,4764527.768299537],[-8528316.722910317,4764524.322563606],[-8528211.91729002,4764514.000110984],[-8528108.011187308,4764496.845143996],[-8528005.449544057,4764472.931122846],[-8527904.671544973,4764442.360451044],[-8527806.108736921,4764405.2640368985],[-8527710.183180973,4764361.800732951],[-8527617.30564509,4764312.156655742],[-8527527.873845138,4764256.544388831],[-8527442.270741815,4764195.202072483],[-8527360.862900749,4764128.392383913],[-8527283.998922816,4764056.401412466],[-8527212.007951368,4763979.537434531],[-8527145.198262798,4763898.129593466],[-8527083.85594645,4763812.526490143],[-8527028.243679538,4763723.09469019],[-8526978.599602329,4763630.217154306],[-8526935.136298383,4763534.29159836],[-8526898.039884238,4763435.7287903065],[-8526867.469212433,4763334.950791224],[-8526843.555191284,4763232.389147974],[-8526826.400224296,4763128.483045259],[-8526816.077771675,4763023.677424963],[-8526812.632035743,4762918.421080843]]],
                            //"rings": [[[-8528421.979254438,4765003.539416097],[-8528278.688176487,4764998.569616499],[-8528136.080366645,4764983.683930181],[-8527994.835828915,4764958.9533810085],[-8527855.628054805,4764924.495964129],[-8527719.120806256,4764880.476080934],[-8527585.964945417,4764827.103751894],[-8527456.795326434,4764764.633611016],[-8527332.227764275,4764693.363686856],[-8527212.85609507,4764613.633976001],[-8527099.249342129,4764525.824815905],[-8526991.949001174,4764430.355064995],[-8526891.466457827,4764327.68009885],[-8526798.280549662,4764218.289632146],[-8526712.83528447,4764102.705376909],[-8526635.537725614,4763981.478548393],[-8526566.756054528,4763855.187230586],[-8526506.817819523,4763724.4336141],[-8526456.008379227,4763589.841119683],[-8526414.569547938,4763452.051421259],[-8526382.698449299,4763311.721382727],[-8526360.546583602,4763169.519923286],[-8526348.219113061,4763026.124826244],[-8526345.774368312,4762882.2195066335],[-8526353.22357836,4762738.489753076],[-8526370.530825075,4762595.620459402],[-8526397.613222351,4762454.2923616795],[-8526434.341318881,4762315.178796124],[-8526480.5397225,4762178.942493327],[-8526535.98794296,4762046.232424036],[-8526600.42144904,4761917.6807114035],[-8526673.532934746,4761793.899624378],[-8526754.97378855,4761675.478666388],[-8526844.355758524,4761562.981773151],[-8526941.25280535,4761456.944632748],[-8527045.203134393,4761357.872140657],[-8527155.711397018,4761266.2360016825],[-8527272.251050748,4761182.472490053],[-8527394.266866941,4761106.980378278],[-8527521.177574135,4761040.119044375],[-8527652.378624443,4760982.206766434],[-8527787.24506996,4760933.51921247],[-8527925.134535493,4760894.288132642],[-8528065.390273593,4760864.700259959],[-8528207.344287435,4760844.896424607],[-8528350.320506789,4760834.97088606],[-8528493.638002088,4760834.97088606],[-8528636.614221442,4760844.896424607],[-8528778.568235284,4760864.700259962],[-8528918.823973384,4760894.288132642],[-8529056.713438917,4760933.51921247],[-8529191.579884434,4760982.206766434],[-8529322.780934744,4761040.119044375],[-8529449.691641934,4761106.980378278],[-8529571.70745813,4761182.472490053],[-8529688.247111859,4761266.236001681],[-8529798.755374484,4761357.872140657],[-8529902.705703527,4761456.944632748],[-8529999.602750354,4761562.98177315],[-8530088.984720325,4761675.478666388],[-8530170.425574131,4761793.899624379],[-8530243.537059838,4761917.680711406],[-8530307.970565915,4762046.232424036],[-8530363.418786379,4762178.942493327],[-8530409.617189994,4762315.178796124],[-8530446.345286526,4762454.2923616795],[-8530473.427683802,4762595.620459402],[-8530490.734930517,4762738.489753076],[-8530498.184140565,4762882.2195066335],[-8530495.739395816,4763026.124826242],[-8530483.411925275,4763169.519923286],[-8530461.260059576,4763311.721382727],[-8530429.388960939,4763452.051421259],[-8530387.95012965,4763589.841119683],[-8530337.140689353,4763724.433614099],[-8530277.202454349,4763855.187230586],[-8530208.42078326,4763981.478548393],[-8530131.123224407,4764102.705376909],[-8530045.677959213,4764218.289632146],[-8529952.492051048,4764327.68009885],[-8529852.009507703,4764430.355064995],[-8529744.709166748,4764525.824815905],[-8529631.102413807,4764613.633976001],[-8529511.730744604,4764693.363686856],[-8529387.163182443,4764764.633611016],[-8529257.99356346,4764827.103751896],[-8529124.83770262,4764880.476080935],[-8528988.330454072,4764924.4959641285],[-8528849.122679962,4764958.9533810085],[-8528707.878142232,4764983.683930181],[-8528565.27033239,4764998.569616499],[-8528421.979254438,4765003.539416097]]],
                            "spatialReference": {
                                "wkid": 102100
                            }
                        },
                        "attributes": {
                            "ATTR_1": 1000.12345,
                            "ATTR_2": 2000.12345,
                            "ATTR_3": 3000.12345
                        },
                        "symbol": {
                            "color": [
                                255 * Math.random(),
                                255 * Math.random(),
                                255 * Math.random(),
                                50
                            ],
                            "outline": {
                                "color": [
                                    255 * Math.random(),
                                    255 * Math.random(),
                                    255 * Math.random(),
                                    255
                                ],
                                "width": 1.5,
                                "type": "esriSLS",
                                "style": "esriSLSSolid"
                            },
                            "type": "esriSFS",
                            "style": "esriSFSSolid"
                        },

                        // emulate attributes

                        "infoTemplate": {
                            "fieldInfos": [
                                {
                                    "fieldName": "ATTR_1",
                                    "label": "Attribute 1",
                                    "format": { places: 1 },
                                    "visible": true
                                },
                                {
                                    "fieldName": "ATTR_2",
                                    "label": "Attribute 2",
                                    "format": { places: 2 },
                                    "visible": true
                                },
                                {
                                    "fieldName": "ATTR_3",
                                    "label": "Attribute 3",
                                    "format": { places: 3 },
                                    "visible": true
                                }
                            ]
                        }
                    }
                }];

                //--------------------------------------------------------------------------
                //
                //  Methods: run player
                //
                //--------------------------------------------------------------------------

                var runReport = function () {

                    var dataProvider = new DataProviderGE();
                    dataProvider.registerCommand(PlayerCommands.PDF);
                    dataProvider.registerCommand(PlayerCommands.IMAGE);
                    dataProvider.registerCommand(PlayerCommands.PRINT);
                    dataProvider.registerCommand(PlayerCommands.DYNAMIC_HTML);

                    var player = new ReportPlayer({
                        isSlidesView: false,
                        theme: PlayerThemes.DARK,
                        dataProvider: dataProvider,
                        resizeMode: PlayerResizeModes.FIT_WINDOW,
                        config: {
                            esriDijitCssUrl: "https://js.arcgis.com/3.25/dijit/themes/claro/claro.css",
                            esriCssUrl: "https://js.arcgis.com/3.25/esri/css/esri.css",
                            playerSourceRootUrl: "https://js.arcgis.com/3.25/" 
                        }
                    }).placeAt(playerDiv);

                    var params = {
                        portalUrl: PORTAL_URL,
                        countryID: "US",
                        //reportID: "88420f4a98bb45cbacacbad67e23266e",
                        reportID: "demographic-summary",
                        analysisAreas: analysisJson
                    };

                    player.playReport(params);
                    /*
                    when(player.playReport(params, { waitUntilAllContentIsReady: true }), function () {

                        // Automatically download an image of the generated infographic report
                        when(player.executeCommand(PlayerCommands.IMAGE, {
                            skipSavingFile: false // true - Array of image files { name: String, data: Blob } will be returned, false - files will be downloaded
                        }), function (imageFiles) {
                            alert(imageFiles);
                            // work with image files
                        });

                    });*/
                }

                runReport();
            });

    </script>
</head>

<body class="claro">
    <div id="playerDiv"></div>
</body>

</html>