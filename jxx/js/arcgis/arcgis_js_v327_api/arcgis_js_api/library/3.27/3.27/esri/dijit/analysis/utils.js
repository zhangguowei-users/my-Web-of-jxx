// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/analysis/utils","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/fx dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/promise/all dojo/fx/easing dojo/number dojo/_base/window dojo/when dojo/dom dojo/on dojo/data/ItemFileWriteStore dojo/topic dojo/store/Memory dojox/mvc/equals dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../units ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ./PCSList ./ItemTypes ../../layers/ArcGISImageServiceLayer ../../layers/RasterFunction ./AnalysisRegistry".split(" "),
function(A,g,p,la,T,I,U,E,V,ma,W,v,B,m,C,J,w,X,r,y,Y,K,z,Z,F,L,M,aa,na,ba,ca,da,ea,N,fa,h,k,G,ga,ha,ia,D,oa,O,pa,ja,qa,P,u,H,ka,t){A={};g.mixin(A,{_helpDialog:null,i18n:null,UNITSMAP:{Feet:"esriFeet",Yards:"esriYards",Miles:"esriMiles",Meters:"esriMeters",Kilometers:"esriKilometers",NauticalMiles:"esriNauticalMiles"},initHelpLinks:function(a,b,d){if(a){var c=da.byNode(a),e=c?c.get("helpFileName"):d&&d.helpFileName?d.helpFileName:null,f=c?c.get("isSingleTenant"):d&&d.isSingleTenant?d.isSingleTenant:
!1,l=t.Modes.standard,n=c&&c.portalSelf?c.portalSelf.helpBase:d&&d.helpBase?d.helpBase:null;this._helpDialog||(this._helpDialog=new ga({isPortal:f}));c&&(c.showGeoAnalyticsParams||c.showBigData)||d&&d.analysisMode&&d.analysisMode===t.Modes.Bigdata?(e+="_bd",l=t.Modes.Bigdata):d&&d.analysisMode&&"raster"===d.analysisMode&&(e+="_ra",l=t.Modes.Raster);C("[esriHelpTopic]",a).forEach(function(c,ra,k){c&&(w.set(c,"display",h.isDefined(b)&&!0!==b?"none":""),h.isDefined(c._helpClickHandler)&&(c._helpClickHandler.remove(),
c._helpClickHandler=null),c._helpClickHandler=M(c,"click",g.hitch(this,function(b){T.stop(b);d&&d.showHelpFromUrl&&d.helpUrl?this._helpDialog.show(b,{showHelpFromUrl:d.showHelpFromUrl,helpUrl:d.helpUrl}):this._helpDialog.show(b,{helpId:E.get(c,"esriHelpTopic"),helpFileName:e,analysisGpServer:d&&d.analysisGpServer?d.analysisGpServer:null,helpParentNode:a,isPortal:f,analysisMode:l,helpBase:n})})))},this)}},constructAnalysisFeatColl:function(a){var b={},d;b.featureCollection=a.layerDefinition;for(d in b.featureCollection)b.featureCollection.hasOwnProperty(d)&&
"objectIdField"===d&&(b.featureCollection.objectIdFieldName=g.clone(b.featureCollection.objectIdField),delete b.featureCollection.objectIdField);b.featureCollection.features=a.featureSet.features;return b},constructAnalysisInputLyrObj:function(a,b,d){var c={},e,f,l;h.isDefined(d)||(d=!0);a.getMap?f=a.getMap():a._map&&(f=a._map);if(a.url&&!a._collection)c={url:a.url},e=this.isHostedService(a.url),l=10.2<=a.version&&a._useStandardizedQueries,a.getDefinitionExpression&&a.getDefinitionExpression()?c.filter=
a.getDefinitionExpression():h.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(c.filter=a.definitionExpression),a.useMapTime&&a.timeInfo&&f&&f.timeExtent&&(l||e||10.2<=a.version)&&d&&(d="",a.timeInfo.startTimeField&&!a.timeInfo.endTimeField?(f.timeExtent.startTime&&(d=a.timeInfo.startTimeField+" \x3e "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.startTime)+"'"),f.timeExtent.endTime&&(f.timeExtent.startTime&&(d+=" AND "),d+=a.timeInfo.startTimeField+" \x3c "+(e?"":"timestamp ")+
"'"+this.formatDate(f.timeExtent.endTime)+"'")):!a.timeInfo.startTimeField&&a.timeInfo.endTimeField?(f.timeExtent.startTime&&(d=a.timeInfo.endTimeField+" \x3e "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.startTime)+"'"),f.timeExtent.endTime&&(f.timeExtent.startTime&&(d+=" AND "),d+=a.timeInfo.endTimeField+" \x3c "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.endTime)+"'")):a.timeInfo.startTimeField&&a.timeInfo.endTimeField&&(f.timeExtent.startTime&&(d=a.timeInfo.startTimeField+" \x3e "+
(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.startTime)+"'"),f.timeExtent.endTime&&(f.timeExtent.startTime&&(d+=" AND "),d+=a.timeInfo.endTimeField+" \x3c "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.endTime)+"'")),c.filter=c.filter?c.filter+(" AND "+d):d),a.credential&&(c.serviceToken=a.credential.token),-1!==c.url.indexOf("?")&&(e=c.url.substring(c.url.indexOf("?")+1,c.url.length),e=W.queryToObject(e),g.mixin(c,e),c.url=c.url.substring(0,c.url.indexOf("?")));else if(!a.url||a._collection)try{c=
a.toJson()}catch(n){a._json=B.parse(a._json),c=a.toJson()}c.name=a.name;b&&(c=new ja(c));return c},formatDate:function(a){return J.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+J.format(a,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},isPortalHostedService:function(a){return a?-1!==a.toLowerCase().indexOf("/hosted/"):
!1},isTimeEnabled:function(a){var b=10.2<=a.version&&a._useStandardizedQueries;return a.useMapTime&&a.timeInfo&&(b||10.2<=a.version)||h.isDefined(a.time)},isTimeInstantLayer:function(a){return h.isDefined(a.timeInfo)&&h.isDefined(a.timeInfo.startTimeField)&&!h.isDefined(a.timeInfo.endTimeField)||h.isDefined(a.time)&&h.isDefined(a.time.timeType)&&"instant"===a.time.timeType},buildReport:function(a,b){var d="";b||(b={},g.mixin(b,v.analysisMsgCodes));p.forEach(a,function(a,e){var c,l,n;"string"===typeof a.message?
(c=h.isDefined(b[a.messageCode])?b[a.messageCode]:a.message,d+=a.style.substring(0,a.style.indexOf("\x3c/"))+(this._isEmptyObject(a.params)?c:m.substitute(c,a.params))+a.style.substring(a.style.indexOf("\x3c/"))):g.isArray(a.message)&&(n=[],l=g.clone(a.style),p.forEach(a.message,function(d,e){l=l.replace(/<\//,"${"+e+"}");c=h.isDefined(b[a.messageCode+"_"+e])?b[a.messageCode+"_"+e]:d;c=this._isEmptyObject(a.params)?c:m.substitute(c,a.params);n.push(c+"\x3c/")},this),l=m.substitute(l,n),d+=l)},this);
return d},getLayerFeatureCount:function(a,b){var d=new ha;d.geometry=b.geometry||"";d.where=b.where||"1\x3d1";d.geometryType=b.geometryType||"esriGeometryEnvelope";a.getDefinitionExpression&&a.getDefinitionExpression()&&!b.where?d.where=a.getDefinitionExpression():h.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&!b.where&&(d.where=a.definitionExpression);return a.queryCount(d)},createPolygonFeatureCollection:function(a){var b;b={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}};
b.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",
supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createPointFeatureCollection:function(a){var b;b={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};b.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,
xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createFolderStore:function(a,b){var d=new aa({data:{identifier:"id",label:"name",items:[]}});d.newItem({name:b,id:""});p.forEach(a,function(a){d.newItem({name:a.title,id:a.id})});return d},setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",
!0);a.folderSelect.set("searchAttr","name");h.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(g.hitch(this,function(b){h.isDefined(b)?a.folderSelect.set("item",b):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:g.hitch(this,function(b){h.isDefined(b)&&0<b.length?a.folderSelect.set("item",b[0]):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})}):a.username?a.folderSelect.set("displayedValue",
a.username):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)},_isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},validateServiceName:function(a,b){var d=/(:|&|<|>|%|#|\?|\\|\"|\/|\+|=|\*|@|\'|;|\||,)/g.test(a),c=!0,e,f;h.isDefined(b)&&b.textInput&&(f=b.textInput);this.initI18n();if(0===a.length||0===m.trim(a).length)e=this.i18n.requiredValue,c=!1;else if(d)e=this.i18n.invalidServiceName,c=!1;else if(98<a.length)e=this.i18n.invalidServiceNameLength,
c=!1;else if(170<encodeURIComponent(a).length){for(a+="";170<encodeURIComponent(a).length;)a=a.substring(0,a.length-1);e=m.substitute(this.i18n.suggestedServiceNameLength,{count:a.length});c=!1}f&&!c&&f.set("invalidMessage",e);return c},getStepNumber:function(a){C(".esriAnalysisNumberLabel",a).forEach(function(a,d){d=this._getNumberLabel(d);E.set(a,"innerHTML",d)},this)},_getNumberLabel:function(a){var b="";this.initI18n();switch(a){case 0:b=this.i18n.oneLabel;break;case 1:b=this.i18n.twoLabel;break;
case 2:b=this.i18n.threeLabel;break;case 3:b=this.i18n.fourLabel;break;case 4:b=this.i18n.fiveLabel;break;case 5:b=this.i18n.sixLabel;break;case 6:b=this.i18n.sevenLabel;break;case 7:b=this.i18n.eightLabel;break;case 8:b=this.i18n.nineLabel}return b},populateAnalysisLayers:function(a,b,d,c){if(a){var e=[],f=a.get(b);b=a._analysisSelect||c.layerSelect;a.rerun&&!f&&(c||(c={}),c.chooseBlank=!0);a._titleRow&&w.set(a._titleRow,"display","none");a._analysisLabelRow&&w.set(a._analysisLabelRow,"display",
"table-row");a._selectAnalysisRow&&(w.set(a._selectAnalysisRow,"display","table-row"),X.add(a._analysisSelect.domNode,"esriTrailingMargin3"),w.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);h.isDefined(c)&&c.chooseLabel&&e.push({value:-1,label:this.i18n.chooseLabel});h.isDefined(c)&&c.chooseBlank&&e.push({value:"  ",label:""});h.isDefined(c)&&h.isDefined(c.posIncrement)||(h.isDefined(c)||(c={}),c.posIncrement=0);a.get(d)||a.set(d,[]);p.forEach(a.get(d),
function(a,b){b+=c.posIncrement;b={value:h.isDefined(c)&&c.chooseLabel?""+b+1:""+b,label:a.name};f&&(a.name===f.name||a.url&&f.url&&a.url===f.url)&&(b.selected=!0);e.push(b)},this);b.addOption(e);b.set("required",!0);c.chooseBlank&&"  "===b.get("value")&&setTimeout(g.hitch(this,this._validateSelectUI,b),100)}},isValidAnalysisLayer:function(a){var b,d,c,e,f,l,n,q="",g=!0;b={isValid:g,validationMessage:q};var k,Q,x=0,R=0,S=0,r,u,v,w=!0;if(!h.isDefined(a)||!h.isDefined(a.toolName))return b;this.initI18n();
b=a.toolName;d=a.layers;c=a.analysisLayer;e=b.charAt(0).toLowerCase()+b.substring(1);n=this.i18n;a=a.showReadyToUseLayers||!1;p.forEach(d,function(a){w=!1;a instanceof H&&(r=!0);r&&1<a.bandCount&&(u=!0);r&&1===a.bandCount&&(v=!0);"esriGeometryPoint"===a.geometryType&&(l=!0,x++);if("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)k=!0;"esriGeometryPolyline"===a.geometryType&&(Q=!0,S++);"esriGeometryPolygon"===a.geometryType&&(f=!0,R++)},this);-1!==p.indexOf(["CreateDriveTimeAreas",
"PlanRoutes","ConnectOriginsToDestinations"],b)&&(!l||c&&"esriGeometryPoint"!==c.geometryType)?(q=m.substitute(this.i18n.selectPointLayer,{toolName:n[e]}),g=!1):"AggregatePoints"!==b&&"InterpolatePoints"!==b||(!c||"esriGeometryPoint"===c.geometryType||"esriGeometryMultipoint"===c.geometryType)&&k?"CalculateDensity"===b&&(!k&&!Q||c&&"esriGeometryPoint"!==c.geometryType&&"esriGeometryMultipoint"!==c.geometryType&&"esriGeometryPolyline"!==c.geometryType)?(q=m.substitute(this.i18n.areaFeatureInvalidMsg,
{toolName:n[e]}),g=!1):"FindHotSpots"!==b&&"FindOutliers"!==b||a||!(!k&&!f||c&&"esriGeometryPoint"!==c.geometryType&&"esriGeometryMultipoint"!==c.geometryType&&"esriGeometryPolygon"!==c.geometryType)?"OverlayLayers"!==b&&"AggregatePoints"!==b&&"SummarizeWithin"!==b&&"SummarizeNearby"!==b&&"FindNearest"!==b&&"MergeLayers"!==b||a||0!==d.length&&(1!==d.length||d[0]!==c&&h.isDefined(c))?"ConnectOriginsToDestinations"===b&&!a&&(w||2>x)?(q=m.substitute(this.i18n.odPointMsg,{toolName:n[e]}),g=!1):this.isFindCentroids(b)&&
this.isPointLayer(c)?(q=m.substitute(this.i18n.selectNoPointLayer,{toolName:n[e]}),g=!1):this.isToolRequiresPointLayer(b)&&0===x?(q=m.substitute(this.i18n.selectPointLayer,{toolName:n[e]}),g=!1):"AggregatePoints"===b&&!a&&1<d.length?(f=p.some(d,function(a){return"esriGeometryPolygon"===a.geometryType}),f||(q=m.substitute(this.i18n.aggregatePolyMsg,{toolName:n[e]}),g=!1)):"MergeLayers"===b&&!a&&1<d.length?1<x||1<S||1<R||(q=this.i18n.mergeValidationMsg,g=!1):"SummarizeWithin"!==b&&"DissolveBoundaries"!==
b||(!c||"esriGeometryPolygon"===c.geometryType)&&f||a?"ExtractData"===b?(g=p.some(d,function(a){return-1!==a.capabilities.indexOf("Extract")}))||(q=m.substitute(this.i18n.extractValidationMsg)):("ConnectOriginsToDestinations"===b||b===t.Tools.ChooseBestFacilities)&&1<d.length?(l=p.some(d,function(a){var b=h.isDefined(c)&&c.id===a.id;return"esriGeometryPoint"===a.geometryType&&!b}),l||(q=m.substitute(b===t.Tools.ChooseBestFacilities?this.i18n.selectPointLayer:this.i18n.odPointMsg,{toolName:n[e]}),
g=!1)):"CalculateSlope"===b||"DeriveAspect"===b||"RemapValues"===b?r?v||(g=!1,q=m.substitute(this.i18n.noSingleBandISMsg,{toolName:n[e]})):(g=!1,q=m.substitute(this.i18n.noImageServiceMsg,{toolName:n[e]})):"ExtractRaster"===b?r||(g=!1,q=m.substitute(this.i18n.noImageServiceMsg,{toolName:n[e]})):"MonitorVegetation"===b&&(r?u||(g=!1,q=m.substitute(this.i18n.noMultiBandISMsg,{toolName:n[e]})):(g=!1,q=m.substitute(this.i18n.noImageServiceMsg,{toolName:n[e]}))):(q=m.substitute(this.i18n.selectPolyLayer,
{toolName:n[e]}),g=!1):(q=m.substitute(this.i18n.overlayValidationMsg,{toolName:n[e]}),g=!1):(q=m.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:n[e]}),g=!1):(q=m.substitute(this.i18n.selectPointLayer,{toolName:n[e]}),g=!1);return b={isValid:g,validationMessage:q}},isToolRequiresPointLayer:function(a){return a===t.Tools.ChooseBestFacilities},isFindCentroids:function(a){return a===t.Tools.FindCentroids},isPointLayer:function(a){return a&&"esriGeometryPoint"===a.geometryType},initI18n:function(){this.i18n||
(this.i18n={},g.mixin(this.i18n,v.common),g.mixin(this.i18n,v.analysisTools),g.mixin(this.i18n,v.analysisMsgCodes),g.mixin(this.i18n,v.browseLayersDlg),g.mixin(this.i18n,v.driveTimes),g.mixin(this.i18n,v.calculateFields))},addBrowseAnalysisDialog:function(a){if(a&&a.widget){this.i18n||this.initI18n();var b="esri/dijit/analysis/PluginAnalysisLayers",d=function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+
"/desktopapp.png")+"'\x3e"},c=function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},e=function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+a.iconUrl+"'/\x3e"},f=function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+a.iconUrl+
"'/\x3e"},l=Z.doc.createDocumentFragment(),l=r.create("div",{style:"width:100%;height:100%;"},l),n=r.create("div",{style:"width:100%;height:10%;","class":""}),q=r.create("div",{style:"width:100%"},l),h,k,m,x=this._isCustomAnalysisQuery(a.widget);1===a.browseType||2===a.browseType?(b="esri/dijit/analysis/PluginLayers",b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),itemsPerPage:100,demandList:!0,extent:a.widget.get("map").extent,
useExtent:!1,fetchTimeout:600,fetchType:2===a.browseType?['type:"'+u.IS+'"']:void 0,galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,checkIsButtonEnabled:!0,formatThumbnail:f,formatInfoPanelImage:e,"class":"esriAnalysisLayersItems"}):b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),pagingLinks:1,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:a.widget.get("map").extent,useExtent:!x,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:c,showInfoPanel:!1,showTooltip:!0,formatThumbnail:d,style:"width:48em;height:100%;clear:both;"};c=r.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');r.place(c,n);d=r.create("div",{"class":"esriBrowseOption"},c);if(!a.browseType||1!==a.browseType&&2!==a.browseType)c=r.create("div",{"class":"esriBrowseOption"},c),k=new N({name:"addlayer",id:a.widget.id+(a.browseType?a.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},r.create("input",{},c)),r.create("label",{"for":a.widget.id+
"_addlayercheck","class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},c);c=!0;!a.browseType||1!==a.browseType&&2!==a.browseType?x&&(c=!1):c=!1;c=new N({name:"extentcheck",id:a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"",value:c,checked:c},r.create("input",{},d));r.create("label",{"for":a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},d);b.messageRight=n;h=new ia(b,q);c.on("change",g.hitch(this,
function(a){h.set("useExtent",a)}));m=new ea({title:1===a.browseType||2===a.browseType?this.i18n.browseLayers:x?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:l,browseItems:h,addlayerCheckBox:k,style:a.browseType&&1===a.browseType?"":"padding:.75em 0;background-color: #fff;width:50em;"});a.widget.own(m.on("hide",g.hitch(m,function(a){m.browseItems.reset()})));return m}},addAnalysisReadyLayer:function(a,b){function d(d){var c,f,n;"Feature Service"===e.type&&(n=new D(e.url,{outFields:["*"]}),
g.mixin(e,n));"Image Service"===e.type&&(n=new H(e.url,{outFields:["*"]}),g.mixin(e,n));g.mixin(e,d);e.id=e.title+"_"+d.id;e.title=a.item.selectedLayer?e.title+"-"+d.name:e.title.replace(/_/g," ");e.name=e.title;e.version=e.currentVersion;if(m){f=(c=a.layersSelect.get("store"))&&c.data;c=2;c=f.splice(f.length-c,c);var l={id:f.length,label:e.title,name:e.title,url:e.url};f.push(l);f=f.concat(c);c=new ba({data:f,idProperty:"id"});a.layersSelect.set("store",c);a.layersSelect.set("value",l.name)}else{f=
a.layersSelect.getOptions();if(a.widget.showBrowseLayers&&a.widget.showReadyToUseLayers)c=3;else if(a.widget.showBrowseLayers||a.widget.showReadyToUseLayers)c=2;c=f.splice(f.length-c,c);a.layersSelect.removeOption(c);f=a.layers.length;a.posIncrement&&(f+=a.posIncrement);f=""+f;c.unshift({value:f,label:e.title,selected:!0});a.layersSelect.addOption(c);a.layersSelect.set("value",f)}n&&(e.lyr=n,n.name=e.name);e.linfo=d;a.layers.push(e);if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||
k||b)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",g.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,layerInfo:d,item:e})})),a.widget.map.addLayer(n);a.browseDialog.browseItems.clear()}if(h.isDefined(a)&&h.isDefined(a.item)&&h.isDefined(a.layersSelect)&&h.isDefined(a.layers)&&h.isDefined(a.browseDialog)){a.browseDialog.hide();var c,e,f,l,n,q;(c=!a.item.selectedLayer&&a.item.url?a.item.url+
"/0":a.item.selectedLayer.url)&&-1!==window.location.protocol.indexOf("https:")&&(c=c.replace("http:","https:"));e={url:c,itemId:a.item.id,title:a.item.title,type:a.item.type,analysisReady:!0};c=p.some(a.layers,function(b,d){var c=b.analysisReady&&e.analysisReady&&b.itemId===e.itemId;a.item.selectedLayer&&a.item.selectedLayer.url&&(c=b.itemId===e.itemId&&b.url===e.url);c&&(f=d);return c});var k;C(".js-add-layer-checkbox",a.browseDialog.browseItems.infoPanel).forEach(function(a){k=a.checked});var m=
-1!==a.layersSelect.baseClass.indexOf("dijitComboBox");l=new y;q="sync";if(c){a.posIncrement&&(f+=a.posIncrement);if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||k||b)a.posIncrement||(a.posIncrement=0),n=a.layers[f-a.posIncrement],a.widget.map.getLayer(n.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",g.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,
layerInfo:n.linfo,item:n})})),a.widget.map.addLayer(n.lyr));m?a.layersSelect.set("value",a.layers[f-1].name):a.layersSelect.set("value",""+f);a.browseDialog.browseItems.clear();l.resolve()}else a.item.selectedLayer?(e.url=a.item.selectedLayer.url,l.then(g.hitch(this,d)),setTimeout(function(){l.resolve(a.item.selectedLayer)},500)):(q=a.item.itemDataUrl?G({url:a.item.itemDataUrl,content:{f:"json"}}):"sync",F(q,g.hitch(this,function(a){a&&a.layers&&a.layers[0].id&&(e.url=e.url.substring(0,e.url.lastIndexOf("/0"))+
"/"+a.layers[0].id);G({url:e.url,content:{f:"json"}}).then(g.hitch(this,function(a){d(a);l.resolve()}))})));return l.promise}},addReadyToUseLayerOption:function(a,b){a&&(a.showReadyToUseLayers||a.showBrowseLayers||a.showBrowseRasterLayers)&&(b||(b=[]),a.signInPromise||(a.signInPromise=new y,setTimeout(g.hitch(this,function(){a.signInPromise.resolve()}),100)),a.i18n||(this.initI18n(),a.i18n=this.i18n),a.signInPromise.then(g.hitch(this,function(){p.forEach(b,function(b){if(-1!==b.baseClass.indexOf("dijitComboBox")&&
a.showBrowseRasterLayers){if(b=b.get("store"))b.put({id:"separator",name:"separator",label:"\x3chr\x3e"}),b.put({id:"browselayers",name:"browselayers",label:a.i18n.browseLayers})}else{var c=b.getOptions();!p.some(c,function(a){return"separator"===a.type},this)&&(a.showReadyToUseLayers||a.showBrowseLayers||a.showBrowseRasterLayers)&&b.addOption({type:"separator",value:""});a.showReadyToUseLayers&&(c=a.i18n.browseAnalysisTitle,this._isCustomAnalysisQuery(a)&&(c=a.i18n.browseAnalysisLayers),b.addOption({value:"browse",
label:c}));a.showBrowseLayers&&b.addOption({value:"browselayers",label:a.i18n.browseLayers})}},this);a.showReadyToUseLayers&&!h.isDefined(a._browsedlg)&&(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",g.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",g.hitch(a,function(){p.forEach(b,function(a){"browse"===a.get("value")&&a.reset()});a.layersSelect&&a.layersSelect.reset()}))));!a.showBrowseLayers&&!a.showBrowseRasterLayers||h.isDefined(a._browseLyrsdlg)||
(a._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:a,browseType:a.showBrowseRasterLayers?2:1}),a.own(a._browseLyrsdlg.on("browseitems-close",g.hitch(this,function(b){"add-layer"===b.action&&(a._browseLyrsdlg.browseItems.plugIn._grid&&(b.selection.selectedLayer=a._browseLyrsdlg.browseItems.plugIn._selectedLayer,a._handleBrowseItemsSelect({dialog:a._browseLyrsdlg,selection:b.selection})),a._browseLyrsdlg.browseItems.closeInfoPanel())})),a._browseLyrsdlg.on("hide",g.hitch(a,function(){p.forEach(b,
function(a){"browselayers"===a.get("value")&&a.reset()})}))))})))},_isCustomAnalysisQuery:function(a){var b='title:"Living Atlas Analysis Layers" AND owner:esri',d=!1;a&&a.isSingleTenant&&(b='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');a.portalSelf&&a.portalSelf.analysisLayersGroupQuery&&a.portalSelf.analysisLayersGroupQuery!==b?d=!0:a._portal&&a._portal.analysisLayersGroupQuery&&a._portal.analysisLayersGroupQuery!==b&&(d=!0);return d},getMaxInputByMode:function(a){if(a&&a.units&&
a.type&&a.limits&&a.travelMode){var b,d=a.limits.maximumBreakDistanceValue,c=a.limits.maximumBreakDistanceValueUnits,e,f=a.travelMode.units;e=a.limits.maximumBreakTimeValue*this.perMinute(a.limits.maximumBreakTimeValueUnits);d*=this.perMile(c);"StraightLine"===a.type?"Miles"===a.units?b=1E3:"Yards"===a.units?b=176E4:"Kilometers"===a.units?b=z.format(1609.344,{places:2}):"Meters"===a.units?b=z.format(1609344,{places:2}):"Feet"===a.units&&(b=528E4):"Distance"===f?"Miles"===a.units?b=d:"Yards"===a.units?
b=1760*d:"Kilometers"===a.units?b=z.format(1.609344*d,{places:2}):"Meters"===a.units?b=z.format(1609.344*d,{places:2}):"Feet"===a.units&&(b=5280*d):"Time"===f&&("Minutes"===a.units?b=e:"Seconds"===a.units?b=60*e:"Hours"===a.units&&(b=e/60));return z.parse(b)}},updateModeConstraints:function(a){var b;a&&a.validateWidget&&a.units&&a.type&&a.travelMode&&(b=a.validateWidget.get("constraints"),b.max=this.getMaxInputByMode(a),a.validateWidget.set(b))},getTravelModes:function(a){var b=new y,d,c,e,f;h.isDefined(this.travelModes)&&
0<this.travelModes.length?b.resolve(this.travelModes):a&&a.widget?a.widget.signInPromise.then(g.hitch(this,function(l){(f=a.widget.get("helperServices"))&&f.routingUtilities?(e=f.routingUtilities.url,d="sync"):d=a.widget._getSelf(a.widget.portalUrl);F(d,g.hitch(this,function(a){a&&a.helperServices&&a.helperServices.routingUtilities&&(e=a.helperServices.routingUtilities.url);h.isDefined(e)?(c=new O(e+"/GetTravelModes"),c.execute({}).then(g.hitch(this,function(a){this.travelModes=p.map(a[0].value&&
a[0].value.features,function(a){return U.fromJson(a.attributes.TravelMode)});a[1]&&a[1].paramName&&"defaultTravelMode"===a[1].paramName&&(this.defaultTravelModeId=a[1].value);b.resolve(this.travelModes)}),g.hitch(this,function(a){b.reject(a)}))):b.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(a){b.reject(a)})})):b.reject(Error("Missing parameter: params.widget required parameter"));return b.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&a.widget){var b=
[],d=a.allowmode||"all",c=!1;this.initI18n();a.addStraightLine&&b.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e",selected:a.value&&"StraightLine"===a.value});this.getTravelModes({widget:a.widget}).then(g.hitch(this,function(e){var f=h.isDefined(a.enableTravelModes)&&!a.enableTravelModes;p.forEach(e,
function(e,g){g=this.createOptionForTravelMode(e,{name:e.name,disabled:f,separator:a.separator});this.isTravelModeAllowed(d,g.units)&&("all"!==d&&(g.value=g.value.replace(g.units,"")),a.value&&a.value.id===e.id?ca(a.value,e)&&(c=g.selected=!0):!a.value&&a.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===e.id&&(g.selected=!0),b.push(g))},this);!c&&this.isRequiredToAddTravelMode(a)&&this.isTravelModeAllowed(d,this.getTravelModeUnits(a.value))&&b.push(this.getOptionForCustomTravelMode(a,
f));a.selectWidget.removeOption();a.selectWidget.addOption(b);a.widget.emit("travelmodes-added",{travelOptions:b})}),g.hitch(this,function(c){b&&0<b.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(b),a.widget.emit("travelmodes-added",{travelOptions:b}))}))}},getTravelModeLabel:function(a,b){b=b?b:a.name;return'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+this.getTravelModei18nKey(a.type)+this.getTravelModeUnits(a)+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;" title\x3d"'+
a.description+'"\x3e'+b+"\x3c/div\x3e"},getTravelModeUnits:function(a){var b=a.units||name.split(/\s/)[1];return b=a.impedanceAttributeName===a.timeAttributeName?"Time":a.impedanceAttributeName===a.distanceAttributeName?"Distance":"Other"},getTravelModeValue:function(a,b){return a.replace(/\s/g,b||"")},getTravelModei18nKey:function(a){return"AUTOMOBILE"===a?"Driving":"TRUCK"===a?"Trucking":"WALK"===a?"Walking":"Other"},isTravelModeAllowed:function(a,b){return"all"===a||a.toLowerCase()===b.toLowerCase()},
isRequiredToAddTravelMode:function(a){return a.widget.rerun&&"StraightLine"!==a.value},getOptionForCustomTravelMode:function(a,b){a=this.createOptionForTravelMode(a.value,{name:"\x26lt"+a.value.name+"\x26gt",disabled:b,separator:a.separator});a.selected=!0;return a},createOptionForTravelMode:function(a,b){return{label:this.getTravelModeLabel(a,b.name),value:this.getTravelModeValue(b.name,b.separator),travelMode:a,disabled:b.disabled,modei18nKey:this.getTravelModei18nKey(a.type).toLowerCase(),units:this.getTravelModeUnits(a)}},
updateDisplay:function(a,b,d){(new C.NodeList(a)).style("display",b?d?d:"block":"none")},isGreaterThanZero:function(){return 0<this.get("value")},getExprFunctions:function(){this.i18n||this.initI18n();this.exprFunctions||(this.exprFunctions=[{type:"NumType",label:m.substitute(this.i18n.asMetersFunc,{functionName:"as_meters(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_meters()"},{type:"NumType",label:m.substitute(this.i18n.asKilometersFunc,{functionName:"as_kilometers(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_kilometers()"},{type:"NumType",label:m.substitute(this.i18n.asFeetFunc,{functionName:"as_feet(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_feet()"},{type:"NumType",label:m.substitute(this.i18n.asYardsFunc,{functionName:"as_yards(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_yards()"},{type:"NumType",label:m.substitute(this.i18n.asMilesFunc,{functionName:"as_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),
name:"as_miles()"},{type:"NumType",label:m.substitute(this.i18n.asNuaticalMilesFunc,{functionName:"as_nautical_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_nautical_miles()"},{type:"NumType",label:m.substitute(this.i18n.absFunc,{functionName:"abs(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"abs()"},{type:"NumType",label:m.substitute(this.i18n.logFunc,{functionName:"log(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"log()"},
{type:"NumType",label:m.substitute(this.i18n.sinFunc,{functionName:"sin(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sin()"},{type:"NumType",label:m.substitute(this.i18n.cosFunc,{functionName:"cos(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"cos()"},{type:"NumType",label:m.substitute(this.i18n.tanFunc,{functionName:"tan(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"tan()"},{type:"NumType",label:m.substitute(this.i18n.squareRootFunc,
{functionName:"sqrt(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sqrt()"},{type:"NumType",label:m.substitute(this.i18n.minFunc,{functionName:"min(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"min()"},{type:"NumType",label:m.substitute(this.i18n.maxFunc,{functionName:"max(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"max()"},{type:"NumType",label:m.substitute(this.i18n.constrainFunc,{functionName:"constrain(\x3ci\x3enumber\x3c/i\x3e, \x3ci\x3elow\x3c/i\x3e, \x3ci\x3ehigh\x3c/i\x3e",
num:"\x3ci\x3enumber\x3c/i\x3e",low:"\x3ci\x3elow\x3c/i\x3e",high:"\x3ci\x3ehigh\x3c/i\x3e"}),name:"constrain(,,)"},{type:"NumType",label:m.substitute(this.i18n.iffFunc,{functionName:"iif(\x3ci\x3econdition\x3c/i\x3e,\x3ci\x3evalue if TRUE\x3c/i\x3e,\x3ci\x3evalue if FALSE\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"iif(,,)"},{type:"NumType",label:m.substitute(this.i18n.whenFunc,{functionName:"when(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"when(,)"},{type:"NumType",
label:m.substitute(this.i18n.decodeFunc,{functionName:"decode(\x3ci\x3eexpression\x3c/i\x3e, \x3ci\x3ecase1,return1,..caseN,returnN\x3c/i\x3e, \x3ci\x3edefault\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"decode(,,,)"}]);return this.exprFunctions},addAttributeOptions:function(a){this.initI18n();h.isDefined(a.allowSelectLabel)||(a.allowSelectLabel=!0);var b,d,c,e=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],f=h.isDefined(a.emptyValue)?a.emptyValue:
"";b=a.layer;d=a.selectWidget;c=b?b.fields:[];d.removeOption(d.getOptions());a.allowSelectLabel&&d.addOption({value:f,label:this.i18n.attribute});a.allowStringType&&e.push("esriFieldTypeString");a.allowDateType&&e.push("esriFieldTypeDate");var g=[];p.forEach(c,function(a){-1!==p.indexOf(e,a.type)&&a.name!==b.objectIdField&&g.push({value:a.name,label:h.isDefined(a.alias)&&""!==a.alias?a.alias:a.name,type:"esriFieldTypeString"===a.type?"string":"esriFieldTypeDate"===a.type?"date":"number"})},this);
if(0===g.length)return!1;d.addOption(g);h.isDefined(a.priorityChange)?d.set("value",f,a.priorityChange):d.set("value",f);d.set("disabled",!b||0===b.fields.length);return!0},addStatisticsOptions:function(a){this.initI18n();var b=a.selectWidget,d=[{value:"SUM",label:this.i18n.sum},{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum},{value:"MEAN",label:a.showGeoAnalyticsParams?this.i18n.mean:this.i18n.average},{value:"STDDEV",label:this.i18n.standardDev}],c=[{value:"MIN",label:this.i18n.minimum},
{value:"MAX",label:this.i18n.maximum}],e=h.isDefined(a.emptyValue)?a.emptyValue:"";b.removeOption(b.getOptions());b.addOption([{value:e,label:this.i18n.statistic}]);a.showGeoAnalyticsParams&&(b.addOption({value:"COUNT",label:this.i18n.count}),d.push({value:"VARIANCE",label:this.i18n.variance}),d.splice(4,0,{value:"RANGE",label:this.i18n.range}));a.type&&"number"!==a.type?a.type&&"string"===a.type?(b.addOption({value:"ANY",label:this.i18n.any}),a.selectWidget.optionsType="string"):a.type&&"date"===
a.type&&(b.addOption(c),a.selectWidget.optionsType="date"):(b.addOption(d),a.selectWidget.optionsType="number");b.set("value",e)},addFillOptions:function(a){var b=a.selectWidget,d=[{value:"ZEROES",label:this.i18n.zeroes},{value:"SPATIAL_NEIGHBORS",label:this.i18n.spatialneighbhors},{value:"SPACE_TIME_NEIGHBORS",label:this.i18n.spacetimeneighbors},{value:"TEMPORAL_TREND",label:this.i18n.temporaltrend}];b.removeOption(b.getOptions());b.addOption([{value:"0",label:this.i18n.fill}]);a.type&&"number"!==
a.type||b.addOption(d)},perMeter:function(a){var b=1;switch(a){case k.MILLIMETERS:b=1E3;break;case k.CENTIMETERS:b=100;break;case k.DECIMETERS:b=10;break;case k.METERS:b=1;break;case k.KILOMETERS:b=.001;break;case k.INCHES:b=39.370079;break;case k.FEET:b=3.2808399;break;case k.YARDS:b=1.0936133;break;case k.MILES:b=6.2137119E-4;break;case k.NAUTICAL_MILES:b=5.399568E-4;break;case k.ACRES:b=2.4710538E-4;break;case k.ARES:b=.01;break;case k.HECTARES:b=1E-4;break;case k.SQUARE_INCHES:b=1550.0031;break;
case k.SQUARE_FEET:b=10.7639104;break;case k.SQUARE_YARDS:b=1.19599005;break;case k.SQUARE_MILES:b=3.86102159E-7;break;case k.SQUARE_NAUTICAL_MILES:b=2.9155335E-7;break;case k.SQUARE_MILLIMETERS:b=1E6;break;case k.SQUARE_CENTIMETERS:b=1E4;break;case k.SQUARE_DECIMETERS:b=100;break;case k.SQUARE_METERS:b=1;break;case k.SQUARE_KILOMETERS:b=1E-6}return b},perMile:function(a){var b=1;switch(a){case "Feet":b=1.89394E-4;break;case "Yards":b=5.68182E-4;break;case "Meters":b=6.21371E-4;break;case "Kilometers":b=
.621371}return b},perMinute:function(a){var b=1;switch(a){case "Seconds":b=.0166667;break;case "Hours":b=60}return b},getType:function(a){var b=null;switch(a){case k.ACRES:b=2;break;case k.ARES:b=2;break;case k.CENTIMETERS:b=1;break;case k.DECIMETERS:b=1;break;case k.FEET:b=1;break;case k.HECTARES:b=2;break;case k.INCHES:b=1;break;case k.KILOMETERS:b=1;break;case k.METERS:b=1;break;case k.MILES:b=1;break;case k.MILLIMETERS:b=1;break;case k.NAUTICAL_MILES:b=1;break;case k.SQUARE_CENTIMETERS:b=2;break;
case k.SQUARE_DECIMETERS:b=2;break;case k.SQUARE_FEET:b=2;break;case k.SQUARE_INCHES:b=2;break;case k.SQUARE_KILOMETERS:b=2;break;case k.SQUARE_METERS:b=2;break;case k.SQUARE_MILES:b=2;break;case k.SQUARE_MILLIMETERS:b=2;break;case k.SQUARE_NAUTICAL_MILES:b=2;break;case k.SQUARE_YARDS:b=2;break;case k.YARDS:b=1;break;default:b=0}return b},unitConversion:function(a,b,d){var c=!0;h.isDefined(a)||(this.emitError("The 'From' Value must be a valid numeric value: "+a),c=!1);h.isDefined(b)||(this.emitError("The 'From' Units must be defined: "+
b),c=!1);h.isDefined(d)||(this.emitError("The 'To' Units must be defined: "+d),c=!1);a instanceof Array&&(this.emitError("Only single 'From' Value supported: "+a),c=!1);b instanceof Array&&(this.emitError("Only single 'From' Units supported: "+b),c=!1);d instanceof Array&&(this.emitError("Only single 'To' Units supported: "+d),c=!1);var e=this.getType(b),f=this.getType(d);0===e&&(this.emitError("Unsupported 'From' Units: "+b),c=!1);0===f&&(this.emitError("Unsupported 'To' Units: "+d),c=!1);e!==f&&
(this.emitError("Incompatible 'From' and 'To' Units: "+b+" and "+d),c=!1);return c?b===d?+a:+a/this.perMeter(b)*this.perMeter(d):Number.NaN},emitError:function(a){console.log("error",Error(a))},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return B.stringify(a)===B.stringify({})},getRoutingUtilities:function(a){var b=new y,d={},c,e,f,l;a||b.reject(Error("Missing parameter: widget required parameter"));-1!==p.indexOf(["CreateDriveTimeAreas","EnrichLayer","SummarizeNearby"],a.toolName)?
g.mixin(d,{toolName:"GenerateServiceAreas",serviceName:"asyncServiceArea"}):a.toolName===t.Tools.ChooseBestFacilities?g.mixin(d,{toolName:"SolveLocationAllocation",serviceName:"asyncLocationAllocation"}):"PlanRoutes"===a.toolName?g.mixin(d,{toolName:"SolveVehicleRoutingProblem",serviceName:"asyncVRP"}):"FindNearest"===a.toolName?g.mixin(d,{toolName:"FindClosestFacilities",serviceName:"asyncClosestFacility"}):"ConnectOriginsToDestinations"===a.toolName&&g.mixin(d,{toolName:"FindRoutes",serviceName:"asyncRoute"});
this.routingUtilities||(this.routingUtilities={});this.routingUtilities&&this.routingUtilities[a.toolName]?b.resolve(this.routingUtilities[a.toolName]):a.signInPromise.then(g.hitch(this,function(k){(l=a.get("helperServices"))&&l.routingUtilities?(f=l.routingUtilities.url,c="sync"):c=a._getSelf(a.portalUrl);F(c,g.hitch(this,function(c){c&&c.helperServices&&c.helperServices.routingUtilities&&(f=c.helperServices.routingUtilities.url);h.isDefined(f)||b.reject(Error("Missing Routing Utility Service to get Network Analysis Service Limits."));
e=new O(f+"/GetToolInfo");e.execute(d).then(g.hitch(this,function(c){c&&0<c.length&&c[0].value?(this.routingUtilities[a.toolName]=c[0].value,b.resolve(c[0].value)):b.reject("Routing Utility Service 'GetToolInfo' job did not return service limits.")}),function(a){b.reject(a)})}))}),function(a){b.reject(a)});return b.promise},getNetworkAnalysisLimits:function(a){var b=new y;a||b.reject(Error("Missing parameter: widget required parameter"));this.getRoutingUtilities(a).then(g.hitch(this,function(a){a.serviceLimits?
b.resolve(a.serviceLimits):b.reject()}),function(a){b.reject(a)});return b.promise},isEsriWorldGeocoder:function(a){var b=this.isAgoWorldGeocodeServer(a);a=this.isAgoWorldGeocodeServerProxy(a);return b||a},isAgoWorldGeocodeServer:function(a){return a&&!!a.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},isAgoWorldGeocodeServerProxy:function(a){return a&&!!a.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},isWorldGeoLocator:function(a){return a&&
!!a.match(/(\/rest\/services\/world\/geocodeserver).*/ig)},showMessages:function(a,b,d){E.set(b,"innerHTML",a);I.fadeIn({node:d,easing:K.quadIn,onEnd:g.hitch(this,function(){w.set(d,{display:""})})}).play()},hideMessages:function(a){I.fadeOut({node:a,easing:K.quadOut,onEnd:function(){w.set(a,{display:"none"})}}).play()},getHelpUrl:function(a){if(a.topic&&a.widget){var b;a.widget.portalSelf&&a.widget.portalSelf.helpBase?b=a.widget.portalSelf.helpBase+"index.html#":!a.widget.isSingleTenant||a.widget.portalSelf&&
a.widget.portalSelf.helpBase||(b="http://server.arcgis.com/en/portal/latest/use/");"BufferExpression"===a.topic&&(b+="Use_expressions_with_GeoAnalytics_Tools/019300000183000000/");return b}},isPCS:function(a){return!!a&&!!P&&-1!==p.indexOf(P,a)},isPCSByLayerType:function(a){var b=!!a&&!!a.fullExtent&&this.isPCS(a.fullExtent.spatialReference.wkid);!b&&a.extent&&(b=!!a&&!!a.extent&&this.isPCS(a.extent.spatialReference.wkid));!b&&a.spatialReference&&(b=!!a&&!!a.spatialReference&&this.isPCS(a.spatialReference.wkid));
return b},checkPCSforAnalysis:function(a){var b=a.widget&&a.widget.toolName,d=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&this.isPCS(a.widget.context.processSR.wkid),c=!0,e=a.jobParams||a.widget.jobParams,f,l,h=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&!!a.widget.context.processSR.wkid;if(!b||!e||!a.widget.showGeoAnalyticsParams)return!1;l="\x3ca  href\x3d'#' id\x3d'"+a.widget.id+"_warn_settings_link'\x3e"+a.widget.i18n.analysisSettings+"\x3c/a\x3e\x3cdiv class\x3d'esriAnalysisSettingsIcon'\x3e\x3c/div\x3e";
f=m.substitute(a.widget.i18n.PCSReqMsg,{defaultSpatialRef:a.widget.i18n.worldCylindrical,settingsIcon:l});"FindHotSpots"!==b&&"FindPointClusters"!==b||d?"CalculateDensity"!==b&&"FindPointClusters"!==b||d?"AggregatePoints"!==b||-1===p.indexOf(["HEXAGON","SQUARE"],e.binType)||d?"SummarizeWithin"===b&&e.summaryPolygons&&!d?c=this.isPCSByLayerType(a.widget.sumWithinLayer):"SummarizeWithin"!==b||-1===p.indexOf(["HEXAGON","SQUARE"],e.binType)||d?"JoinFeatures"===b&&e.spatialNearDistance&&!d?(c=this.isPCSByLayerType(a.widget.targetLayer))||
(f=m.substitute(a.widget.i18n.JFPCSReqMsg,{settingsIcon:l})):"BuildMultiVariableGrid"!==b||d||(c=p.every(a.inputLayers,function(a){return this.isPCSByLayerType(a)},this)):c=this.isPCSByLayerType(a.widget.summaryLayer):c=this.isPCSByLayerType(a.widget.pointLayer):c=this.isPCSByLayerType(a.widget.inputLayer):(c=this.isPCSByLayerType(a.widget.analysisLayer),"FindPointClusters"!==b||c||(f=m.substitute(a.widget.i18n.FPCSReqMsg,{settingsIcon:l})));c||a.hasPCSWarnShown||(a.widget.set("disableRunAnalysis",
c),this.settingsVM&&this.settingsDlg&&a.widget._bodyNode&&a.widget._errorMessagePane&&(this.showMessages(f,a.widget._bodyNode,a.widget._errorMessagePane),L.byId(a.widget.id+"_warn_settings_link")&&M(L.byId(a.widget.id+"_warn_settings_link"),"click",g.hitch(a.widget,a.widget.showSettingsDlg))));!c&&a.hasPCSWarnShown&&h&&(c=!0);return c},tryParseJSON:function(a){try{var b=B.parse(a);if(b&&"object"===typeof b&&null!==b)return b}catch(d){}return!1},decodeTag:function(a){return{"\x26lt;":"\x3c","\x26gt;":"\x3e"}[a]||
a},stringDecode:function(a){return a.replace(/(&lt;|&gt;)/g,this.decodeTag)},jobParamsToWidgetProps:function(a){if(a&&a.jobParams){var b=a.jobParams,d=new y,c=[],e=[],f;for(f in b){var l;b.hasOwnProperty(f)&&("string"===typeof b[f]&&-1!==b[f].search(/(&lt;|&gt;)/g)&&(b[f]=this.stringDecode(b[f])),l="string"===typeof b[f]?this.tryParseJSON(b[f]):b[f])&&(-1!==f.toLowerCase().indexOf("layer")&&"object"===typeof l?e.push({key:f,obj:l}):l&&(l.Raster||l.url)&&e.push({key:f,obj:l}),b[f]=l)}for(f=0;f<e.length;f++){l=
e[f].obj;var h=e[f].key;"object"===typeof l&&l.length?(b[h]=[],p.forEach(l,function(a,d){this._getFlayers(a,h,b,c,!0,d)},this)):"object"===typeof l&&l.Raster?(l.url=l.Raster.url,this._getFlayers(l,h,b,c,!0,"Raster")):this._getFlayers(l,h,b,c)}Y(c).then(g.hitch(this,function(){d.resolve(a)}),g.hitch(this,function(){d.resolve(a)}));return d.promise}},_getLayerType:function(a){return a?-1!==a.indexOf("BigDataCatalogServer")?u.BIGDATA:-1!==a.indexOf("ImageServer")?u.IS:u.FS:null},_getFlayers:function(a,
b,d,c,e,f){var h,k;a.url?(h=G({url:a.url,content:{f:"json"}}),k=new y,c.push(k),h.then(g.hitch(this,function(a,b,c,f,h){var k,l=this._getLayerType(a.url);l===u.FS?(k=new D(a.url,{mode:D.MODE_ONDEMAND,outFields:["*"],resourceInfo:h}),a.filter&&k.setDefinitionExpression(a.filter),k.filter=a.filter):l===u.BIGDATA?(k=h,g.mixin(k,a)):l===u.IS&&(h=a.Raster||a,k=new H(h.url),h.renderingRule&&k.setRenderingRule(new ka(h.renderingRule)),h.name&&(k.name=h.name),a.Raster&&a.Raster.url===a.url&&delete a.url);
a.name&&(k.name=a.name);e?d[b][f]=k:e&&l===u.IS?g.mixin(d[b][f],k):d[b]=k;c.resolve()},a,b,k,f),g.hitch(this,function(a,b,c,f,g){a={name:a.name,empty:!0};e?d[b][f]=a:d[b]=a;c.resolve()},a,b,k,f))):(c=new D(a,{outFields:["*"]}),a.name&&(c.name=a.name),e?d[b][f]=c:d[b]=c)},isLayerInLayers:function(a,b){return p.some(b,function(b){return b.name===a.name||b.url&&a.url&&b.url===a.url})},addBlankOption:function(a,b){b&&b.length?b.push({value:"  ",label:""}):a.addOption({value:"  ",label:""});setTimeout(g.hitch(this,
this._validateSelectUI,a),100)},_validateSelectUI:function(a){a._hasBeenBlurred=!0;a.set("focused",!0);a.validate();a.set("focused",!1);a._hasBeenBlurred=!1;setTimeout(g.hitch(this,function(){a.reset()}),1E3)},updateExpressions:function(a){a&&a.selectedInputLayers&&a.inputLayers&&a.data&&a.expressions&&(p.forEach(a.selectedInputLayers,function(b,d){p.forEach(a.inputLayers,function(a,e){a&&b&&(!b.url&&!a.url&&b.name===a.name||b.url&&a.url&&b.url===a.url)&&(b._oldIndex=d,b._newIndex=e)})}),p.forEach(a.data,
function(b,d){0<d&&b&&(d=a.expressions[d-1],h.isDefined(b.layer)&&(b.layer=d&&d.layer),h.isDefined(b.selectingLayer)&&(b.selectingLayer=d&&d.selectingLayer))}),p.forEach(a.data,function(b){var d=!1,c=!1;p.forEach(a.selectedInputLayers,function(a){h.isDefined(b.layer)&&b.layer===a._oldIndex&&!d&&(b.layer=a._newIndex,d=!0);h.isDefined(b.selectingLayer)&&b.selectingLayer===a._oldIndex&&!c&&(b.selectingLayer=a._newIndex,c=!0)},this)},this))},isBigDataTypeTobeAdded:function(a){return-1==p.indexOf(a,'type:"Big Data File Share"')?
!0:!1},removeDuplicates:function(a,b){for(var d=[],c={},e=0;e<a.length;e++)c[a[e]]?c[a[e]]+=1:(d.push(a[e]),c[a[e]]=1);return b?c:d},isPoint:function(a){return a&&a.geometryType===t.GeometryTypes.Point},isLine:function(a){return a&&a.geometryType===t.GeometryTypes.Line},isPolygon:function(a){return a&&a.geometryType===t.GeometryTypes.Polygon},isSameLayer:function(a,b){return a&&b&&(a.name&&b.name&&a.name===b.name||a.url&&b.url&&a.url===b.url)},getTimeType:function(a){return a?h.isDefined(a.timeInfo)&&
h.isDefined(a.timeInfo.startTimeField)&&!h.isDefined(a.timeInfo.endTimeField)?t.TimeTypes.Instant:h.isDefined(a.timeInfo)&&h.isDefined(a.timeInfo.startTimeField)&&h.isDefined(a.timeInfo.endTimeField)?t.TimeTypes.Interval:h.isDefined(a.time)&&h.isDefined(a.time.timeType)?a.time.timeType:t.TimeTypes.None:!1}});V("extend-esri")&&g.setObject("dijit.analysis.utils",A,fa);return A});