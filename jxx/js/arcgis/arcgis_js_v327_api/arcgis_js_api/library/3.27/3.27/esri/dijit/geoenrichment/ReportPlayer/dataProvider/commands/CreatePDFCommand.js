// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreatePDFCommand","require dojo/_base/declare dojo/Deferred dojo/when ./CreateHTMLCommand ../../PlayerCommands ./supportClasses/ProgressSteps ./createHTML/CommandMode ../supportClasses/GEUtil esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi ../../_devConfig".split(" "),function(d,t,u,l,v,w,e,x,m,y,a,z){function A(){var k=new u;d(["esri/dijit/geoenrichment/utils/FileUtil","esri/dijit/geoenrichment/utils/MaskUtil",
"esri/dijit/geoenrichment/utils/requests/FileContent","./supportClasses/LayoutXMLBuilder"],function(c,e,b,a){n=c;p=e;q=b;r=a;k.resolve()});return k.promise}a=a.geoenrichment.dijit.ReportPlayer.ReportPlayer;var n,p,q,r;return t(v,{id:w.PDF,label:a.createPDFCommandLabel,errorMessage:a.createPDFError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:x.SVG,_requestSizeLimit:9E6,execute:function(k,c,a){var b=this,d=this.inherited(arguments);return A().then(function(){var a=function(a){if(!c.skipErrorNotification)return b._handleError(a)};
return l(d,function(h){if(h&&h.svgStrings){var g=r.buildLayoutXML(h);z.createPDFCommand.removeUnicodeChars&&(g=p.removeXMLMasks(g,"X"));if(c.returnLayoutXMLOnly)return g;var d={report:k.getReportTitle(),format:"pdf",f:"bin"},g=q.fromFileData("report.xml",g);delete g.filename;d["report.xml"]=g;return m.formatReport(d).then(function(f){if(f&&f.data)return c.creditsTaskID&&m.consumeCredits(c.creditsTaskID),b._stepFinished(e.FORMAT_REPORT),f={name:k.getReportTitle()+".pdf",data:f.data},c.skipSavingFile||
y.createPDFCommand.skipSavingFile||(b._saveMultipleFiles&&h.additionalFiles&&h.additionalFiles.length?b._saveMultipleFiles(f,h.additionalFiles):n.saveAs(f.data,f.name)),f;a()})}}).otherwise(a).always(function(a){return l(b._printableContainer&&b._printableContainer.stop(),function(){return a})})}.bind(this))},_saveMultipleFiles:null,_stepFinished:function(a,c,d){if(this._currentProgressBack){var b=0;switch(a){case e.REPLACE_MAPS:b=10;break;case e.PREPARE_DOM:b=20;break;case e.RENDER_PAGE:b=20+60*
c/d;break;case e.UNSET_LAYOUT:b=90;break;case e.FORMAT_REPORT:b=100}this._currentProgressBack(b/100)}}})});