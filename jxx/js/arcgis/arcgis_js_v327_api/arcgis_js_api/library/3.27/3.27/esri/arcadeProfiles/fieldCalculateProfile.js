// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/arcadeProfiles/fieldCalculateProfile","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../arcade/featureset/support/RecentlyUsedCache ../support/expressionUtils ./utils".split(" "),function(d,g,n,p,q,r,t,c,e){d=new (d(null,{declaredClass:"esri.arcadeProfiles.FieldCalculateProfile",defaults:{globals:{featureSet:["$layer","$datastore"],async:["$layer","$datastore"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any"}}},_lruCache:null,constructor:function(){this._lruCache=
new t},initialize:function(a){var b=[];e.hasGeometryOperations(a)&&b.push(c.enableGeometryOperations());(e.hasFeatureSetOperations(a)||e.hasVariables(a,this.defaults.globals.featureSet))&&b.push(c.enableFeatureSetOperations());e.isAsync(a)&&b.push(c.enableAsyncOperations());return q(b)},isAsync:function(a){a=[a];return e.hasFeatureSetOperations(a)||e.hasVariables(a,this.defaults.globals.async)},parse:function(a){return c.createSyntaxTree(a.expression)},compile:function(a){var b=g.clone(this.defaults.context);
b.useAsync=a.async;return a.syntaxTree?c.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=a.expression,h=a.feature,f=a.layer,d=a.spatialReference;a=a.portal;var h=h&&b.hasVariable("$feature")?r.createFromGraphicLikeObject(h.geometry,h.attributes,f):null,g,m;if(f){var k={spatialReference:d,cache:this._lruCache};b.hasVariable("$layer")&&(g=f.getMap()?c.createFeatureSetFromLayer(f,k):c.createFeatureSetFromLayerUrl(f.url,k));b.hasVariable("$datastore")&&(m=(b=e.getServiceUrl(f.url))?
c.createFeatureSetCollectionFromServiceUrl(b,k):null)}var l;a&&(a=a.replace(/\/+$/ig,""),l={url:a,portalUrl:a+"/sharing/rest"});return{context:{vars:{$feature:h,$layer:g,$datastore:m},services:l?{portal:l}:null,lrucache:this._lruCache,spatialReference:d}}}}));n("extend-esri")&&g.setObject("arcadeProfiles.fieldCalculateProfile",d,p);return d});